/*
	Redactor v8.2.2
	Updated: January 17, 2013
	http://redactorjs.com/
*/
var rwindow,rdocument;if(typeof RELANG==="undefined"){var RELANG={}}var RLANG={html:"HTML代码",video:"视频",image:"图片",table:"表格",link:"链接",link_insert:"插入链接",unlink:"取消链接",formatting:"样式",paragraph:"段落",quote:"引用",code:"代码",header1:"一级标题",header2:"二级标题",header3:"三级标题",header4:"四级标题",bold:"粗体",italic:"斜体",fontcolor:"字体颜色",backcolor:"背景颜色",unorderedlist:"项目编号",orderedlist:"数字编号",outdent:"减少缩进",indent:"增加缩进",cancel:"取消",insert:"插入",save:"保存",_delete:"删除",insert_table:"插入表格",insert_row_above:"在上方插入",insert_row_below:"在下方插入",insert_column_left:"在左侧插入",insert_column_right:"在右侧插入",delete_column:"删除整列",delete_row:"删除整行",delete_table:"删除表格",rows:"行",columns:"列",add_head:"添加标题",delete_head:"删除标题",title:"标题",image_position:"位置",none:"无",left:"左",right:"右",image_web_link:"图片网页链接",text:"文本",mailto:"邮箱",web:"网址",video_html_code:"视频嵌入代码",file:"文件",upload:"上传",download:"下载",choose:"选择",or_choose:"或选择",drop_file_here:"将文件拖拽至此区域",align_left:"左对齐",align_center:"居中",align_right:"右对齐",align_justify:"两端对齐",horizontalrule:"水平线",fullscreen:"全屏",deleted:"删除",anchor:"锚点",link_new_tab:"在新窗口打开",underline:"下划线",alignment:"对齐方式"};(function(c){jQuery.fn.redactor=function(a){return this.each(function(){var b=c(this);var f=b.data("redactor");if(!f){b.data("redactor",(f=new d(this,a)))}})};var d=function(a,b){this.$el=c(a);if(typeof b!=="undefined"&&typeof b.lang!=="undefined"&&b.lang!=="en"&&typeof RELANG[b.lang]!=="undefined"){RLANG=RELANG[b.lang]}this.opts=c.extend({iframe:false,css:false,lang:"en",direction:"ltr",callback:false,keyupCallback:false,keydownCallback:false,execCommandCallback:false,plugins:false,cleanup:true,focus:false,tabindex:false,autoresize:true,minHeight:false,fixed:false,fixedTop:0,fixedBox:false,source:true,shortcuts:true,mobile:true,air:false,wym:false,convertLinks:true,convertDivs:true,protocol:"http://",autosave:false,autosaveCallback:false,interval:60,imageGetJson:false,imageUpload:false,imageUploadCallback:false,imageUploadErrorCallback:false,fileUpload:false,fileUploadCallback:false,fileUploadErrorCallback:false,uploadCrossDomain:false,uploadFields:false,observeImages:true,overlay:true,allowedTags:["form","input","button","select","option","datalist","output","textarea","fieldset","legend","section","header","hgroup","aside","footer","article","details","nav","progress","time","canvas","code","span","div","label","a","br","p","b","i","del","strike","u","img","video","source","track","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],toolbarExternal:false,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],emptyHtml:"<p><br /></p>",buffer:false,visual:true,modal_file:String()+'<div id="redactor_modal_content"><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>文件名(选填)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form><br></div>',modal_image_edit:String()+'<div id="redactor_modal_content"><label>'+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select></div><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" class="redactor_modal_btn">'+RLANG._delete+'</a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+RLANG.save+'" /></div>',modal_image:String()+'<div id="redactor_modal_content"><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+RLANG.insert+'" /></div>',modal_link:String()+'<div id="redactor_modal_content"><form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /></div>',modal_table:String()+'<div id="redactor_modal_content"><label>'+RLANG.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /></div>',modal_video:String()+'<div id="redactor_modal_content"><form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /></div>',toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignment:{title:RLANG.alignment,func:"show",dropdown:{alignleft:{title:RLANG.align_left,exec:"JustifyLeft"},aligncenter:{title:RLANG.align_center,exec:"JustifyCenter"},alignright:{title:RLANG.align_right,exec:"JustifyRight"},justify:{title:RLANG.align_justify,exec:"JustifyFull"}}},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"JustifyFull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},b,this.$el.data());this.dropdowns=[];this.init()};d.prototype={init:function(){this.height=this.$el.css("height");this.width=this.$el.css("width");rdocument=this.document=document;rwindow=this.window=window;if(this.opts.mobile===false&&this.isMobile()){this.build(true);return false}if(this.opts.iframe){this.opts.autoresize=false}if(this.opts.air){this.opts.buttons=this.opts.airButtons}else{if(this.opts.toolbar!==false){if(this.opts.source===false){var b=this.opts.buttons.indexOf("html");var a=this.opts.buttons[b+1];this.opts.buttons.splice(b,1);if(typeof a!=="undefined"&&a==="|"){this.opts.buttons.splice(b,1)}}c.extend(this.opts.toolbar,this.opts.buttonsCustom);c.each(this.opts.buttonsAdd,c.proxy(function(h,e){this.opts.buttons.push(e)},this))}}if(this.opts.toolbar!==false){c.each(this.opts.toolbar.formatting.dropdown,c.proxy(function(h,e){if(c.inArray(h,this.opts.formattingTags)=="-1"){delete this.opts.toolbar.formatting.dropdown[h]}},this))}function f(){this.enableAir();this.buildToolbar();if(typeof this.opts.plugins==="object"){c.each(this.opts.plugins,c.proxy(function(h,g){if(typeof RedactorPlugins[g]!=="undefined"){c.extend(this,RedactorPlugins[g]);if(typeof RedactorPlugins[g].init!=="undefined"){this.init()}}},this))}if(this.opts.activeButtons!==false&&this.opts.toolbar!==false){var k=c.proxy(function(){this.observeFormatting()},this);this.$editor.click(k).keyup(k)}var e=false;if(this.browser("webkit")&&navigator.userAgent.indexOf("Chrome")===-1){var l=this.browser("version").split(".");if(l[0]<536){e=true}}if(this.isMobile(true)===false&&e===false){this.$editor.bind("paste",c.proxy(function(h){if(this.opts.cleanup===false){return true}this.pasteRunning=true;this.setBuffer();if(this.opts.autoresize===true){this.saveScroll=this.document.body.scrollTop}else{this.saveScroll=this.$editor.scrollTop()}var g=this.extractContent();setTimeout(c.proxy(function(){var n=this.extractContent();this.$editor.append(g);this.restoreSelection();var i=this.getFragmentHtml(n);this.pasteCleanUp(i);this.pasteRunning=false},this),1)},this))}this.keyup();this.keydown();if(this.opts.autosave!==false){this.autoSave()}setTimeout(c.proxy(function(){this.observeImages();this.observeTables()},this),1);if(this.browser("mozilla")){this.$editor.click(c.proxy(function(){this.saveSelection()},this));try{this.document.execCommand("enableObjectResizing",false,false);this.document.execCommand("enableInlineTableEditing",false,false)}catch(j){}}if(this.opts.focus){setTimeout(c.proxy(function(){this.$editor.focus()},this),1)}if(this.opts.fixed){this.observeScroll();c(document).scroll(c.proxy(this.observeScroll,this))}if(typeof this.opts.callback==="function"){this.opts.callback(this)}if(this.opts.toolbar!==false){this.$toolbar.find("a").attr("tabindex","-1")}}this.build(false,f)},shortcuts:function(a,b){a.preventDefault();this.execCommand(b,false)},keyup:function(){this.$editor.keyup(c.proxy(function(a){var b=a.keyCode||a.which;if(this.browser("mozilla")&&!this.pasteRunning){this.saveSelection()}if(typeof this.opts.keyupCallback==="function"){this.opts.keyupCallback(this,a)}if(b===8||b===46){this.observeImages();return this.formatEmpty(a)}if(b===13&&!a.shiftKey&&!a.ctrlKey&&!a.metaKey){if(this.browser("webkit")){this.formatNewLine(a)}if(this.opts.convertLinks){this.$editor.linkify()}}this.syncCode()},this))},keydown:function(){this.$editor.keydown(c.proxy(function(a){var m=a.keyCode||a.which;var l=this.getParentNode();var b=this.getCurrentNode();var e=false;var k=a.ctrlKey||a.metaKey;if((l||b)&&(c(l).get(0).tagName==="PRE"||c(b).get(0).tagName==="PRE")){e=true}if(typeof this.opts.keydownCallback==="function"){this.opts.keydownCallback(this,a)}if(k&&this.opts.shortcuts){if(m===90){if(this.opts.buffer!==false){a.preventDefault();this.getBuffer()}else{if(a.shiftKey){this.shortcuts(a,"redo")}else{this.shortcuts(a,"undo")}}}else{if(m===77){this.shortcuts(a,"removeFormat")}else{if(m===66){this.shortcuts(a,"bold")}else{if(m===73){this.shortcuts(a,"italic")}else{if(m===74){this.shortcuts(a,"insertunorderedlist")}else{if(m===75){this.shortcuts(a,"insertorderedlist")}else{if(m===76){this.shortcuts(a,"superscript")}else{if(m===72){this.shortcuts(a,"subscript")}}}}}}}}}if(!k&&m!==90){this.opts.buffer=false}if(e===true&&m===13){a.preventDefault();var n=c(b).parent().text();this.insertNodeAtCaret(this.document.createTextNode("\r\n"));if(n.search(/\s$/)==-1){this.insertNodeAtCaret(this.document.createTextNode("\r\n"))}this.syncCode();return false}if(this.opts.shortcuts&&!a.shiftKey&&m===9){if(e===false){this.shortcuts(a,"indent")}else{a.preventDefault();this.insertNodeAtCaret(this.document.createTextNode("\t"));this.syncCode();return false}}else{if(this.opts.shortcuts&&a.shiftKey&&m===9){this.shortcuts(a,"outdent")}}if(this.browser("webkit")&&navigator.userAgent.indexOf("Chrome")===-1){return this.safariShiftKeyEnter(a,m)}},this))},build:function(l,a){if(l!==true){this.$box=c('<div class="redactor_box"></div>');if(this.opts.air){this.air=c('<div class="redactor_air" style="display: none;"></div>')}this.$content=null;function b(){this.$editor=this.$content.contents().find("body").attr("contenteditable",true).attr("dir",this.opts.direction);rdocument=this.document=this.$editor[0].ownerDocument;rwindow=this.window=this.document.defaultView||window;if(this.opts.css!==false){this.$content.contents().find("head").append('<link rel="stylesheet" href="'+this.opts.css+'" />')}this.$editor.html(k);if(a){a.call(this);a=null}}this.textareamode=true;if(this.$el.get(0).tagName==="TEXTAREA"){if(this.opts.iframe){var j=this;this.$content=c('<iframe style="width: 100%;" frameborder="0"></iframe>').load(function(){b.call(j)})}else{this.$content=this.$editor=c("<div></div>")}var m=this.$el.get(0).className.split(/\s+/);c.each(m,c.proxy(function(f,e){this.$content.addClass("redactor_"+e)},this))}else{this.textareamode=false;this.$content=this.$editor=this.$el;this.$el=c('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height)}if(this.$editor){this.$editor.addClass("redactor_editor").attr("contenteditable",true).attr("dir",this.opts.direction)}if(this.opts.tabindex!==false){this.$content.attr("tabindex",this.opts.tabindex)}if(this.opts.minHeight!==false){this.$content.css("min-height",this.opts.minHeight+"px")}if(this.opts.wym===true){this.$content.addClass("redactor_editor_wym")}if(this.opts.autoresize===false){this.$content.css("height",this.height)}this.$el.hide();var k="";if(this.textareamode){k=this.$el.val();k=this.savePreCode(k);this.$box.insertAfter(this.$el).append(this.$content).append(this.$el)}else{k=this.$editor.html();k=this.savePreCode(k);this.$box.insertAfter(this.$content).append(this.$el).append(this.$editor)}k=this.paragraphy(k);if(this.$editor){this.$editor.html(k)}if(this.textareamode===false){this.syncCode()}}else{if(this.$el.get(0).tagName!=="TEXTAREA"){var k=this.$el.val();var n=c('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(k);this.$el.hide();this.$el.after(n)}}if(a&&this.$editor){a.call(this)}},enableAir:function(){if(this.opts.air===false){return false}this.air.hide();this.$editor.bind("textselect",c.proxy(function(a){this.showAir(a)},this));this.$editor.bind("textunselect",c.proxy(function(){this.air.hide()},this))},showAir:function(a){c(".redactor_air").hide();var h=this.air.innerWidth();var b=a.clientX;if(c(this.document).width()<(b+h)){b=b-h}var e=a.clientY+c(document).scrollTop()+14;if(this.opts.iframe===true){e=e+this.$box.position().top;b=b+this.$box.position().left}this.air.css({left:b+"px",top:e+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(a){a=this.stripTags(a);this.$editor.html(a).focus();this.syncCode()},getCode:function(){var a="";if(this.opts.visual){a=this.$editor.html()}else{a=this.$el.val()}return this.stripTags(a)},insertHtml:function(a){this.$editor.focus();this.pasteHtmlAtCaret(a);this.observeImages();this.syncCode()},pasteHtmlAtCaret:function(m){var b,n;if(this.document.getSelection){b=this.window.getSelection();if(b.getRangeAt&&b.rangeCount){n=b.getRangeAt(0);n.deleteContents();var l=this.document.createElement("div");l.innerHTML=m;var a=this.document.createDocumentFragment(),j,k;while(j=l.firstChild){k=a.appendChild(j)}n.insertNode(a);if(k){n=n.cloneRange();n.setStartAfter(k);n.collapse(true);b.removeAllRanges();b.addRange(n)}}}else{if(this.document.selection&&this.document.selection.type!="Control"){this.document.selection.createRange().pasteHTML(m)}}},destroy:function(){var a=this.getCode();if(this.textareamode){this.$box.after(this.$el);this.$box.remove();this.$el.height(this.height).val(a).show()}else{this.$box.after(this.$editor);this.$box.remove();this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",false).html(a).show()}if(this.opts.toolbarExternal){c(this.opts.toolbarExternal).empty()}c(".redactor_air").remove();for(var b=0;b<this.dropdowns.length;b++){this.dropdowns[b].remove();delete (this.dropdowns[b])}if(this.opts.autosave!==false){clearInterval(this.autosaveInterval)}},observeFormatting:function(){var b=this.getCurrentNode();this.inactiveAllButtons();c.each(this.opts.activeButtonsStates,c.proxy(function(h,e){if(c(b).closest(h,this.$editor.get()[0]).length!=0){this.setBtnActive(e)}},this));var f=c(b).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if(typeof f[0]!=="undefined"&&typeof f[0].elem!=="undefined"&&c(f[0].elem).size()!=0){var a=c(f[0].elem).css("text-align");switch(a){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft");break}}},observeImages:function(){if(this.opts.observeImages===false){return false}this.$editor.find("img").each(c.proxy(function(b,a){if(this.browser("msie")){c(a).attr("unselectable","on")}this.resizeImage(a)},this))},observeTables:function(){this.$editor.find("table").click(c.proxy(this.tableObserver,this))},observeScroll:function(){var h=c(this.document).scrollTop();var a=this.$box.offset().top;var b=0;if(h>a){var g="100%";if(this.opts.fixedBox){b=this.$box.offset().left;g=this.$box.innerWidth()}this.fixed=true;this.$toolbar.css({position:"fixed",width:g,zIndex:1005,top:this.opts.fixedTop+"px",left:b})}else{this.fixed=false;this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:b})}},setBuffer:function(){this.saveSelection();this.opts.buffer=this.$editor.html()},getBuffer:function(){if(this.opts.buffer===false){return false}this.$editor.html(this.opts.buffer);if(!this.browser("msie")){this.restoreSelection()}this.opts.buffer=false},execCommand:function(q,s){if(this.opts.visual==false){this.$el.focus();return false}try{var b;if(q==="inserthtml"){if(this.browser("msie")){this.$editor.focus();this.document.selection.createRange().pasteHTML(s)}else{this.pasteHtmlAtCaret(s)}this.observeImages()}else{if(q==="unlink"){b=this.getParentNode();if(c(b).get(0).tagName==="A"){c(b).replaceWith(c(b).text())}else{this.execRun(q,s)}}else{if(q==="JustifyLeft"||q==="JustifyCenter"||q==="JustifyRight"||q==="JustifyFull"){b=this.getCurrentNode();var a=c(b).get(0).tagName;if(this.opts.iframe===false&&c(b).parents(".redactor_editor").size()==0){return false}var o=["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","TD"];if(c.inArray(a,o)!=-1){var m=false;if(q==="JustifyCenter"){m="center"}else{if(q==="JustifyRight"){m="right"}else{if(q==="JustifyFull"){m="justify"}}}if(m===false){c(b).css("text-align","")}else{c(b).css("text-align",m)}}else{this.execRun(q,s)}}else{if(q==="formatblock"&&s==="blockquote"){b=this.getCurrentNode();if(c(b).get(0).tagName==="BLOCKQUOTE"){if(this.browser("msie")){var p=c("<p>"+c(b).html()+"</p>");c(b).replaceWith(p)}else{this.execRun(q,"p")}}else{if(c(b).get(0).tagName==="P"){var e=c(b).parent();if(c(e).get(0).tagName==="BLOCKQUOTE"){var p=c("<p>"+c(b).html()+"</p>");c(e).replaceWith(p);this.setSelection(p[0],0,p[0],0)}else{if(this.browser("msie")){var p=c("<blockquote>"+c(b).html()+"</blockquote>");c(b).replaceWith(p)}else{this.execRun(q,s)}}}else{this.execRun(q,s)}}}else{if(q==="formatblock"&&(s==="pre"||s==="p")){b=this.getParentNode();if(c(b).get(0).tagName==="PRE"){c(b).replaceWith("<p>"+this.encodeEntities(c(b).text())+"</p>")}else{this.execRun(q,s)}}else{if(q==="inserthorizontalrule"&&this.browser("msie")){this.$editor.focus()}if(q==="formatblock"&&this.browser("mozilla")){this.$editor.focus()}this.execRun(q,s)}}}}}if(q==="inserthorizontalrule"){this.$editor.find("hr").removeAttr("id")}this.syncCode();if(this.oldIE()){this.$editor.focus()}if(typeof this.opts.execCommandCallback==="function"){this.opts.execCommandCallback(this,q)}if(this.opts.air){this.air.hide()}}catch(n){}},execRun:function(b,a){if(b==="formatblock"&&this.browser("msie")){a="<"+a+">"}this.document.execCommand(b,false,a)},formatNewLine:function(b){var e=this.getParentNode();if(e.nodeName==="DIV"&&e.className==="redactor_editor"){var h=c(this.getCurrentNode());if(h.get(0).tagName==="DIV"&&(h.html()===""||h.html()==="<br>")){var a=c("<p>").append(h.clone().get(0).childNodes);h.replaceWith(a);a.html("<br />");this.setSelection(a[0],0,a[0],0)}}},safariShiftKeyEnter:function(a,b){if(a.shiftKey&&b===13){a.preventDefault();this.insertNodeAtCaret(c("<span><br /></span>").get(0));this.syncCode();return false}else{return true}},formatEmpty:function(a){var h=c.trim(this.$editor.html());h=h.replace(/<br\s?\/?>/i,"");var b=h.replace(/<p>\s?<\/p>/gi,"");if(h===""||b===""){a.preventDefault();var e=c(this.opts.emptyHtml).get(0);this.$editor.html(e);this.setSelection(e,0,e,0);this.syncCode();return false}else{this.syncCode()}},paragraphy:function(b){b=c.trim(b);if(b===""||b==="<p></p>"){return this.opts.emptyHtml}if(this.opts.convertDivs){b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}var a=function(f,e,j){return f.replace(new RegExp(e,"g"),j)};var h=function(e,f){return a(b,e,f)};var g="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";b+="\n";h("<br />\\s*<br />","\n\n");h("(<"+g+"[^>]*>)","\n$1");h("(</"+g+">)","$1\n\n");h("\r\n|\r","\n");h("\n\n+","\n\n");h("\n?((.|\n)+?)$","<p>$1</p>\n");h("<p>\\s*?</p>","");h("<p>(<div[^>]*>\\s*)","$1<p>");h("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2");h("<p>\\s*(</?"+g+"[^>]*>)\\s*</p>","$1");h("<p>(<li.+?)</p>","$1");h("<p>\\s*(</?"+g+"[^>]*>)","$1");h("(</?"+g+"[^>]*>)\\s*</p>","$1");h("(</?"+g+"[^>]*>)\\s*<br />","$1");h("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1");if(b.indexOf("<pre")!=-1){h("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(e,f,k,l){return a(f,"\\\\(['\"\\\\])","$1")+a(a(a(l,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"})}return h("\n</p>$","</p>")},stripTags:function(b){var a=this.opts.allowedTags;var f=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return b.replace(f,function(e,h){return c.inArray(h.toLowerCase(),a)>"-1"?e:""})},savePreCode:function(b){var a=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(a!==null){c.each(a,c.proxy(function(i,h){var j=h.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);j[2]=this.encodeEntities(j[2]);b=b.replace(h,"<pre"+j[1]+">"+j[2]+"</pre>")},this))}return b},encodeEntities:function(a){a=String(a).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"');return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanupPre:function(a){a=a.replace(/<br>/gi,"\n");a=a.replace(/<\/p>/gi,"\n");a=a.replace(/<\/div>/gi,"\n");var b=this.document.createElement("div");b.innerHTML=a;return b.textContent||b.innerText},pasteCleanUp:function(b){var a=this.getParentNode();if(c(a).get(0).tagName==="PRE"){b=this.cleanupPre(b);this.pasteCleanUpInsert(b);return true}b=b.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"");b=b.replace(/(&nbsp;){2,}/gi,"&nbsp;");b=b.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2");b=this.stripTags(b);b=b.replace(/<td><\/td>/gi,"[td]");b=b.replace(/<td>&nbsp;<\/td>/gi,"[td]");b=b.replace(/<td><br><\/td>/gi,"[td]");b=b.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]');b=b.replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]");b=b.replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]");b=b.replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]");b=b.replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]");b=b.replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]");b=b.replace(/<param(.*?)>/gi,"[param$1]");b=b.replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]");b=b.replace(/<(\w+)([\w\W]*?)>/gi,"<$1>");b=b.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");b=b.replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"");b=b.replace(/\[td\]/gi,"<td>&nbsp;</td>");b=b.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>');b=b.replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>");b=b.replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>");b=b.replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>");b=b.replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>");b=b.replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>");b=b.replace(/\[param(.*?)\]/gi,"<param$1>");b=b.replace(/\[img(.*?)\]/gi,"<img$1>");if(this.opts.convertDivs){b=b.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")}b=b.replace(/<span>([\w\W]*?)<\/span>/gi,"$1");b=b.replace(/\n{3,}/gi,"\n");b=b.replace(/<p><p>/gi,"<p>");b=b.replace(/<\/p><\/p>/gi,"</p>");if(this.browser("mozilla")){b=b.replace(/<br>$/gi,"")}this.pasteCleanUpInsert(b)},pasteCleanUpInsert:function(a){this.execCommand("inserthtml",a);if(this.opts.autoresize===true){c(this.document.body).scrollTop(this.saveScroll)}else{this.$editor.scrollTop(this.saveScroll)}},formattingRemove:function(b){var f=[];var a=b.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);if(a!==null){c.each(a,function(h,e){b=b.replace(e,"prebuffer_"+h);f.push(e)})}b=b.replace(/\s{2,}/g," ");b=b.replace(/\n/g," ");b=b.replace(/[\t]*/g,"");b=b.replace(/\n\s*\n/g,"\n");b=b.replace(/^[\s\n]*/g,"");b=b.replace(/[\s\n]*$/g,"");b=b.replace(/>\s+</g,"><");if(f){c.each(f,function(h,e){b=b.replace("prebuffer_"+h,e)});f=[]}return b},formattingIndenting:function(a){a=a.replace(/<li/g,"\t<li");a=a.replace(/<tr/g,"\t<tr");a=a.replace(/<td/g,"\t\t<td");a=a.replace(/<\/tr>/g,"\t</tr>");return a},formattingEmptyTags:function(a){var b=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"];for(var g=0;g<b.length;++g){var h=b[g];a=a.replace(new RegExp(h,"gi"),"")}return a},formattingAddBefore:function(h){var b="\r\n";var a=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"];for(var i=0;i<a.length;++i){var j=a[i];h=h.replace(new RegExp(j,"gi"),b+j)}return h},formattingAddAfter:function(h){var a="\r\n";var j=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"];for(var i=0;i<j.length;++i){var b=j[i];h=h.replace(new RegExp(b,"gi"),b+a)}return h},formatting:function(a){a=this.formattingRemove(a);a=this.formattingEmptyTags(a);a=this.formattingAddBefore(a);a=this.formattingAddAfter(a);a=this.formattingIndenting(a);return a},toggle:function(){var a;if(this.opts.visual){var b=this.$editor.innerHeight();this.$editor.hide();this.$content.hide();a=this.$editor.html();this.$el.height(b).val(a).show().focus();this.setBtnActive("html");this.opts.visual=false}else{this.$el.hide();var a=this.$el.val();this.$editor.html(a).show();this.$content.show();if(this.$editor.html()===""){this.setCode(this.opts.emptyHtml)}this.$editor.focus();this.setBtnInactive("html");this.opts.visual=true;this.observeImages();this.observeTables()}},autoSave:function(){this.autosaveInterval=setInterval(c.proxy(function(){c.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+escape(encodeURIComponent(this.getCode())),success:c.proxy(function(a){if(typeof this.opts.autosaveCallback==="function"){this.opts.autosaveCallback(a,this)}},this)})},this),this.opts.interval*1000)},buildToolbar:function(){if(this.opts.toolbar===false){return false}this.$toolbar=c("<ul>").addClass("redactor_toolbar");if(this.opts.air){c(this.air).append(this.$toolbar);c("body").append(this.air)}else{if(this.opts.toolbarExternal===false){this.$box.prepend(this.$toolbar)}else{c(this.opts.toolbarExternal).html(this.$toolbar)}}c.each(this.opts.buttons,c.proxy(function(b,f){if(f!=="|"&&typeof this.opts.toolbar[f]!=="undefined"){var a=this.opts.toolbar[f];if(this.opts.fileUpload===false&&f==="file"){return true}this.$toolbar.append(c("<li>").append(this.buildButton(f,a)))}if(f==="|"){this.$toolbar.append(c('<li class="redactor_separator"></li>'))}},this))},buildButton:function(g,b){var h=c('<a href="javascript:void(null);" title="'+b.title+'" class="redactor_btn_'+g+'"></a>');if(typeof b.func==="undefined"){h.click(c.proxy(function(){if(c.inArray(g,this.opts.activeButtons)!=-1){this.inactiveAllButtons();this.setBtnActive(g)}if(this.browser("mozilla")){this.$editor.focus()}this.execCommand(b.exec,g)},this))}else{if(b.func!=="show"){h.click(c.proxy(function(e){this[b.func](e)},this))}}if(typeof b.callback!=="undefined"&&b.callback!==false){h.click(c.proxy(function(e){b.callback(this,e,g)},this))}if(g==="backcolor"||g==="fontcolor"||typeof(b.dropdown)!=="undefined"){var a=c('<div class="redactor_dropdown" style="display: none;">');if(g==="backcolor"||g==="fontcolor"){a=this.buildColorPicker(a,g)}else{a=this.buildDropdown(a,b.dropdown)}this.dropdowns.push(a.appendTo(c(document.body)));this.hdlShowDropDown=c.proxy(function(e){this.showDropDown(e,a,g)},this);h.click(this.hdlShowDropDown)}return h},buildDropdown:function(a,b){c.each(b,c.proxy(function(j,h){if(typeof(h.className)==="undefined"){h.className=""}var i;if(typeof h.name!=="undefined"&&h.name==="separator"){i=c('<a class="redactor_separator_drop">')}else{i=c('<a href="javascript:void(null);" class="'+h.className+'">'+h.title+"</a>");if(typeof(h.callback)==="function"){c(i).click(c.proxy(function(e){h.callback(this,e,j)},this))}else{if(typeof(h.func)==="undefined"){c(i).click(c.proxy(function(){this.execCommand(h.exec,j)},this))}else{c(i).click(c.proxy(function(e){this[h.func](e)},this))}}}c(a).append(i)},this));return a},buildColorPicker:function(a,b){var o;if(b==="backcolor"){if(this.browser("msie")){o="BackColor"}else{o="hilitecolor"}}else{o="forecolor"}c(a).width(210);var n=this.opts.colors.length;for(var p=0;p<n;++p){var s=this.opts.colors[p];var i=c('<a rel="'+s+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:s});c(a).append(i);var m=this;c(i).click(function(){m.execCommand(o,c(this).attr("rel"));if(o==="forecolor"){m.$editor.find("font").replaceWith(function(){return c('<span style="color: '+c(this).attr("color")+';">'+c(this).html()+"</span>")})}if(m.browser("msie")&&o==="BackColor"){m.$editor.find("font").replaceWith(function(){return c('<span style="'+c(this).attr("style")+'">'+c(this).html()+"</span>")})}})}var q=c('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);if(b==="backcolor"){q.click(c.proxy(this.setBackgroundNone,this))}else{q.click(c.proxy(this.setColorNone,this))}c(a).append(q);return a},setBackgroundNone:function(){c(this.getParentNode()).css("background-color","transparent");this.syncCode()},setColorNone:function(){c(this.getParentNode()).attr("color","").css("color","");this.syncCode()},showDropDown:function(b,a,m){if(this.getBtn(m).hasClass("dropact")){this.hideAllDropDown()}else{this.hideAllDropDown();this.setBtnActive(m);this.getBtn(m).addClass("dropact");var e=this.getBtn(m).offset().left;if(this.opts.air){var l=this.air.offset().top;c(a).css({position:"absolute",left:e+"px",top:l+30+"px"}).show()}else{if(this.opts.fixed&&this.fixed){c(a).css({position:"fixed",left:e+"px",top:"30px"}).show()}else{var k=this.$toolbar.offset().top+30;c(a).css({position:"absolute",left:e+"px",top:k+"px"}).show()}}}var n=c.proxy(function(f){this.hideDropDown(f,a,m)},this);c(document).one("click",n);this.$editor.one("click",n);this.$content.one("click",n);b.stopPropagation()},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact");c(".redactor_dropdown").hide()},hideDropDown:function(b,a,e){if(!c(b.target).hasClass("dropact")){c(a).removeClass("dropact");this.showedDropDown=false;this.hideAllDropDown()}},getBtn:function(a){if(this.opts.toolbar===false){return false}return c(this.$toolbar.find("a.redactor_btn_"+a))},setBtnActive:function(a){this.getBtn(a).addClass("redactor_act")},setBtnInactive:function(a){this.getBtn(a).removeClass("redactor_act")},inactiveAllButtons:function(){c.each(this.opts.activeButtons,c.proxy(function(b,a){this.setBtnInactive(a)},this))},changeBtnIcon:function(b,a){this.getBtn(b).addClass("redactor_btn_"+a)},removeBtnIcon:function(b,a){this.getBtn(b).removeClass("redactor_btn_"+a)},addBtnSeparator:function(){this.$toolbar.append(c('<li class="redactor_separator"></li>'))},addBtnSeparatorAfter:function(b){var a=this.getBtn(b);a.parent().after(c('<li class="redactor_separator"></li>'))},addBtnSeparatorBefore:function(b){var a=this.getBtn(b);a.parent().before(c('<li class="redactor_separator"></li>'))},removeBtnSeparatorAfter:function(b){var a=this.getBtn(b);a.parent().next().remove()},removeBtnSeparatorBefore:function(b){var a=this.getBtn(b);a.parent().prev().remove()},setBtnRight:function(a){if(this.opts.toolbar===false){return false}this.getBtn(a).parent().addClass("redactor_btn_right")},setBtnLeft:function(a){if(this.opts.toolbar===false){return false}this.getBtn(a).parent().removeClass("redactor_btn_right")},addBtn:function(i,h,a,b){if(this.opts.toolbar===false){return false}var j=this.buildButton(i,{title:h,callback:a,dropdown:b});this.$toolbar.append(c("<li>").append(j))},addBtnFirst:function(i,h,a,b){if(this.opts.toolbar===false){return false}var j=this.buildButton(i,{title:h,callback:a,dropdown:b});this.$toolbar.prepend(c("<li>").append(j))},addBtnAfter:function(a,m,k,b,j){if(this.opts.toolbar===false){return false}var n=this.buildButton(m,{title:k,callback:b,dropdown:j});var l=this.getBtn(a);l.parent().after(c("<li>").append(n))},addBtnBefore:function(j,m,k,a,b){if(this.opts.toolbar===false){return false}var n=this.buildButton(m,{title:k,callback:a,dropdown:b});var l=this.getBtn(j);l.parent().before(c("<li>").append(n))},removeBtn:function(f,a){var b=this.getBtn(f);if(a===true){b.parent().next().remove()}b.parent().removeClass("redactor_btn_right");b.remove()},getFragmentHtml:function(b){var f=b.cloneNode(true);var a=this.document.createElement("div");a.appendChild(f);return a.innerHTML},extractContent:function(){var f=this.$editor.get(0);var a=this.document.createDocumentFragment(),b;while((b=f.firstChild)){a.appendChild(b)}return a},saveSelection:function(){this.$editor.focus();this.savedSel=this.getOrigin();this.savedSelObj=this.getFocus()},restoreSelection:function(){if(typeof this.savedSel!=="undefined"&&this.savedSel!==null&&this.savedSelObj!==null&&this.savedSel[0].tagName!=="BODY"){if(this.opts.iframe===false&&c(this.savedSel[0]).closest(".redactor_editor").size()==0){this.$editor.focus()}else{if(this.browser("opera")){this.$editor.focus()}this.setSelection(this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]);if(this.browser("mozilla")){this.$editor.focus()}}}else{this.$editor.focus()}},getSelection:function(){var a=this.document;if(this.window.getSelection){return this.window.getSelection()}else{if(a.getSelection){return a.getSelection()}else{return a.selection.createRange()}}return false},hasSelection:function(){if(!this.oldIE()){var a;return(a=this.getSelection())&&(a.focusNode!=null)&&(a.anchorNode!=null)}else{var b=this.$editor.get(0);var f;b.focus();if(!b.document.selection){return false}f=b.document.selection.createRange();return f&&f.parentElement().document===b.document}},getOrigin:function(){if(!this.oldIE()){var a;if(!((a=this.getSelection())&&(a.anchorNode!=null))){return null}return[a.anchorNode,a.anchorOffset]}else{var b=this.$editor.get(0);var f;b.focus();if(!this.hasSelection()){return null}f=b.document.selection.createRange();return this._getBoundary(b.document,f,true)}},getFocus:function(){if(!this.oldIE()){var a;if(!((a=this.getSelection())&&(a.focusNode!=null))){return null}return[a.focusNode,a.focusOffset]}else{var b=this.$editor.get(0);var f;b.focus();if(!this.hasSelection()){return null}f=b.document.selection.createRange();return this._getBoundary(b.document,f,false)}},setSelection:function(a,b,e,m){if(e==null){e=a}if(m==null){m=b}if(!this.oldIE()){var n=this.getSelection();if(!n){return}if(n.collapse&&n.extend){n.collapse(a,b);n.extend(e,m)}else{r=this.document.createRange();r.setStart(a,b);r.setEnd(e,m);try{n.removeAllRanges()}catch(l){}n.addRange(r)}}else{var o=this.$editor.get(0);var p=o.document.body.createTextRange();this._moveBoundary(o.document,p,false,e,m);this._moveBoundary(o.document,p,true,a,b);return p.select()}},getCurrentNode:function(){if(typeof this.window.getSelection!=="undefined"){return this.getSelectedNode().parentNode}else{if(typeof this.document.selection!=="undefined"){return this.getSelection().parentElement()}}},getParentNode:function(){return c(this.getCurrentNode()).parent()[0]},getSelectedNode:function(){if(this.oldIE()){return this.getSelection().parentElement()}else{if(typeof this.window.getSelection!=="undefined"){var a=this.window.getSelection();if(a.rangeCount>0){return this.getSelection().getRangeAt(0).commonAncestorContainer}else{return false}}else{if(typeof this.document.selection!=="undefined"){return this.getSelection()}}}},_getBoundary:function(k,m,l){var a,p,n,b,o;p=k.createElement("a");a=m.duplicate();a.collapse(l);o=a.parentElement();while(true){o.insertBefore(p,p.previousSibling);a.moveToElementText(p);if(!(a.compareEndPoints((l?"StartToStart":"StartToEnd"),m)>0&&(p.previousSibling!=null))){break}}if(a.compareEndPoints((l?"StartToStart":"StartToEnd"),m)===-1&&p.nextSibling){a.setEndPoint((l?"EndToStart":"EndToEnd"),m);n=p.nextSibling;b=a.text.length}else{n=p.parentNode;b=this._getChildIndex(p)}p.parentNode.removeChild(p);return[n,b]},_moveBoundary:function(o,a,b,s,q){var n,p,m,u,t;t=0;n=this._isText(s)?s:s.childNodes[q];p=this._isText(s)?s.parentNode:s;if(this._isText(s)){t=q}u=o.createElement("a");p.insertBefore(u,n||null);m=o.body.createTextRange();m.moveToElementText(u);u.parentNode.removeChild(u);a.setEndPoint((b?"StartToStart":"EndToEnd"),m);return a[b?"moveStart":"moveEnd"]("character",t)},_isText:function(a){return(a!=null?a.nodeType==3:false)},_getChildIndex:function(a){var b=0;while(a=a.previousSibling){b++}return b},insertNodeAfterCaret:function(a){this.saveSelection();this.insertNodeAtCaret(a);this.restoreSelection()},insertNodeAtCaret:function(j){if(this.window.getSelection){var b=this.getSelection();if(b.rangeCount){var m=b.getRangeAt(0);m.collapse(false);m.insertNode(j);m=m.cloneRange();m.selectNodeContents(j);m.collapse(false);b.removeAllRanges();b.addRange(m)}}else{if(this.document.selection){var l=(j.nodeType===1)?j.outerHTML:j.data;var a="marker_"+(""+Math.random()).slice(2);l+='<span id="'+a+'"></span>';var k=this.getSelection();k.collapse(false);k.pasteHTML(l);var n=this.document.getElementById(a);k.moveToElementText(n);k.select();n.parentNode.removeChild(n)}}},getSelectedHtml:function(){var b="";if(this.window.getSelection){var a=this.window.getSelection();if(a.rangeCount){var i=this.document.createElement("div");for(var h=0,j=a.rangeCount;h<j;++h){i.appendChild(a.getRangeAt(h).cloneContents())}b=i.innerHTML}}else{if(this.document.selection){if(this.document.selection.type==="Text"){b=this.document.selection.createRange().htmlText}}}return b},resizeImage:function(l){var k=false;var o=false;var m;var p;var b=c(l).width()/c(l).height();var n=10;var a=10;c(l).off("hover mousedown mouseup click mousemove");c(l).hover(function(){c(l).css("cursor","nw-resize")},function(){c(l).css("cursor","");k=false});c(l).mousedown(function(e){e.preventDefault();b=c(l).width()/c(l).height();k=true;o=true;m=Math.round(e.pageX-c(l).eq(0).offset().left);p=Math.round(e.pageY-c(l).eq(0).offset().top)});c(l).mouseup(c.proxy(function(e){k=false;c(l).css("cursor","");this.syncCode()},this));c(l).click(c.proxy(function(e){if(o){this.imageEdit(e)}},this));c(l).mousemove(function(i){if(k){o=false;var f=Math.round(i.pageX-c(this).eq(0).offset().left)-m;var g=Math.round(i.pageY-c(this).eq(0).offset().top)-p;var j=c(l).height();var h=parseInt(j,10)+g;var e=h*b;if(e>n){c(l).width(e)}if(h>a){c(l).height(h)}m=Math.round(i.pageX-c(this).eq(0).offset().left);p=Math.round(i.pageY-c(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection();this.modalInit(RLANG.table,this.opts.modal_table,300,c.proxy(function(){c("#redactor_insert_table_btn").click(c.proxy(this.insertTable,this));setTimeout(function(){c("#redactor_table_rows").focus()},200)},this))},insertTable:function(){var a=c("#redactor_table_rows").val();var q=c("#redactor_table_columns").val();var u=c("<div></div>");var t=Math.floor(Math.random()*99999);var i=c('<table id="table'+t+'"><tbody></tbody></table>');for(var p=0;p<a;p++){var b=c("<tr></tr>");for(var n=0;n<q;n++){var s=c("<td><br></td>");c(b).append(s)}c(i).append(b)}c(u).append(i);var o=c(u).html()+"<p></p>";this.restoreSelection();this.execCommand("inserthtml",o);this.modalClose();this.observeTables()},tableObserver:function(a){this.$table=c(a.target).closest("table");this.$table_tr=this.$table.find("tr");this.$table_td=this.$table.find("td");this.$tbody=c(a.target).closest("tbody");this.$thead=c(this.$table).find("thead");this.$current_td=c(a.target);this.$current_tr=c(a.target).closest("tr")},deleteTable:function(){c(this.$table).remove();this.$table=false;this.syncCode()},deleteRow:function(){c(this.$current_tr).remove();this.syncCode()},deleteColumn:function(){var a=c(this.$current_td).get(0).cellIndex;c(this.$table).find("tr").each(function(){c(this).find("td").eq(a).remove()});this.syncCode()},addHead:function(){if(c(this.$table).find("thead").size()!==0){this.deleteHead()}else{var a=c(this.$table).find("tr").first().clone();a.find("td").html("&nbsp;");this.$thead=c("<thead></thead>");this.$thead.append(a);c(this.$table).prepend(this.$thead);this.syncCode()}},deleteHead:function(){c(this.$thead).remove();this.$thead=false;this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(b){var a=c(this.$current_tr).clone();a.find("td").html("&nbsp;");if(b==="after"){c(this.$current_tr).after(a)}else{c(this.$current_tr).before(a)}this.syncCode()},insertColumn:function(a){var b=0;this.$current_tr.find("td").each(c.proxy(function(h,g){if(c(g)[0]===this.$current_td[0]){b=h}},this));this.$table_tr.each(function(l,k){var j=c(k).find("td").eq(b);var i=j.clone();i.html("&nbsp;");if(a==="after"){c(j).after(i)}else{c(j).before(i)}});this.syncCode()},showVideo:function(){this.saveSelection();this.modalInit(RLANG.video,this.opts.modal_video,600,c.proxy(function(){c("#redactor_insert_video_btn").click(c.proxy(this.insertVideo,this));setTimeout(function(){c("#redactor_insert_video_area").focus()},200)},this))},insertVideo:function(){var a=c("#redactor_insert_video_area").val();a=this.stripTags(a);this.restoreSelection();this.execCommand("inserthtml",a);this.modalClose()},imageEdit:function(b){var h=c(b.target);var e=h.parent();var a=c.proxy(function(){c("#redactor_file_alt").val(h.attr("alt"));c("#redactor_image_edit_src").attr("href",h.attr("src"));c("#redactor_form_image_align").val(h.css("float"));if(c(e).get(0).tagName==="A"){c("#redactor_file_link").val(c(e).attr("href"))}c("#redactor_image_delete_btn").click(c.proxy(function(){this.imageDelete(h)},this));c("#redactorSaveBtn").click(c.proxy(function(){this.imageSave(h)},this))},this);this.modalInit(RLANG.image,this.opts.modal_image_edit,380,a)},imageDelete:function(a){c(a).remove();this.modalClose();this.syncCode()},imageSave:function(g){var h=c(g).parent();c(g).attr("alt",c("#redactor_file_alt").val());var a=c("#redactor_form_image_align").val();if(a==="left"){c(g).css({"float":"left",margin:"0 10px 10px 0"})}else{if(a==="right"){c(g).css({"float":"right",margin:"0 0 10px 10px"})}else{c(g).css({"float":"none",margin:"0"})}}var b=c.trim(c("#redactor_file_link").val());if(b!==""){if(c(h).get(0).tagName!=="A"){c(g).replaceWith('<a href="'+b+'">'+this.outerHTML(g)+"</a>")}else{c(h).attr("href",b)}}else{if(c(h).get(0).tagName==="A"){c(h).replaceWith(this.outerHTML(g))}}this.modalClose();this.observeImages();this.syncCode()},showImage:function(){this.saveSelection();var a=c.proxy(function(){if(this.opts.imageGetJson!==false){c.getJSON(this.opts.imageGetJson,c.proxy(function(m){var o={};var k=0;c.each(m,c.proxy(function(f,e){if(typeof e.folder!=="undefined"){k++;o[e.folder]=k}},this));var n=false;c.each(m,c.proxy(function(i,h){var e="";if(typeof h.title!=="undefined"){e=h.title}var g=0;if(!c.isEmptyObject(o)&&typeof h.folder!=="undefined"){g=o[h.folder];if(n===false){n=".redactorfolder"+g}}var f=c('<img src="'+h.thumb+'" class="redactorfolder redactorfolder'+g+'" rel="'+h.image+'" title="'+e+'" />');c("#redactor_image_box").append(f);c(f).click(c.proxy(this.imageSetThumb,this))},this));if(!c.isEmptyObject(o)){c(".redactorfolder").hide();c(n).show();var l=function(e){c(".redactorfolder").hide();c(".redactorfolder"+c(e.target).val()).show()};var p=c('<select id="redactor_image_box_select">');c.each(o,function(e,f){p.append(c('<option value="'+f+'">'+e+"</option>"))});c("#redactor_image_box").before(p);p.change(l)}},this))}else{c("#redactor_tabs a").eq(1).remove()}if(this.opts.imageUpload!==false){if(this.opts.uploadCrossDomain===false&&this.isMobile()===false){if(c("#redactor_file").size()!==0){c("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:c.proxy(this.imageUploadCallback,this),error:c.proxy(this.opts.imageUploadErrorCallback,this)})}}this.uploadInit("redactor_file",{auto:true,url:this.opts.imageUpload,success:c.proxy(this.imageUploadCallback,this),error:c.proxy(this.opts.imageUploadErrorCallback,this)})}else{c(".redactor_tab").hide();if(this.opts.imageGetJson===false){c("#redactor_tabs").remove();c("#redactor_tab3").show()}else{var b=c("#redactor_tabs a");b.eq(0).remove();b.eq(1).addClass("redactor_tabs_act");c("#redactor_tab2").show()}}c("#redactor_upload_btn").click(c.proxy(this.imageUploadCallbackLink,this));if(this.opts.imageUpload===false&&this.opts.imageGetJson===false){setTimeout(function(){c("#redactor_file_link").focus()},200)}},this);this.modalInit(RLANG.image,this.opts.modal_image,610,a)},imageSetThumb:function(a){this._imageSet('<img src="'+c(a.target).attr("rel")+'" alt="'+c(a.target).attr("title")+'" />',true)},imageUploadCallbackLink:function(){if(c("#redactor_file_link").val()!==""){var a='<img src="'+c("#redactor_file_link").val()+'" />';this._imageSet(a,true)}else{this.modalClose()}},imageUploadCallback:function(a){this._imageSet(a)},_imageSet:function(b,a){this.restoreSelection();if(b!==false){var f="";if(a!==true){f='<p><img src="'+b.filelink+'" /></p>'}else{f=b}this.execCommand("inserthtml",f);if(a!==true&&typeof this.opts.imageUploadCallback==="function"){this.opts.imageUploadCallback(this,b)}}this.modalClose();this.observeImages()},showLink:function(){this.saveSelection();var a=c.proxy(function(){this.insert_link_node=false;var l=this.getSelection();var p="",b="",k="";if(this.browser("msie")){var n=this.getParentNode();if(n.nodeName==="A"){this.insert_link_node=c(n);b=this.insert_link_node.text();p=this.insert_link_node.attr("href");k=this.insert_link_node.attr("target")}else{if(this.oldIE()){b=l.text}else{b=l.toString()}}}else{if(l&&l.anchorNode&&l.anchorNode.parentNode.tagName==="A"){p=l.anchorNode.parentNode.href;b=l.anchorNode.parentNode.text;k=l.anchorNode.parentNode.target;if(l.toString()===""){this.insert_link_node=l.anchorNode.parentNode}}else{b=l.toString()}}c(".redactor_link_text").val(b);var o=self.location.href.replace(/\/$/i,"");var m=p.replace(o,"");if(p.search("mailto:")===0){this.setModalTab(2);c("#redactor_tab_selected").val(2);c("#redactor_link_mailto").val(p.replace("mailto:",""))}else{if(m.search(/^#/gi)===0){this.setModalTab(3);c("#redactor_tab_selected").val(3);c("#redactor_link_anchor").val(m.replace(/^#/gi,""))}else{c("#redactor_link_url").val(m)}}if(k==="_blank"){c("#redactor_link_blank").attr("checked",true)}c("#redactor_insert_link_btn").click(c.proxy(this.insertLink,this));setTimeout(function(){c("#redactor_link_url").focus()},200)},this);this.modalInit(RLANG.link,this.opts.modal_link,460,a)},insertLink:function(){var k=c("#redactor_tab_selected").val();var m="",a="",o="",b="";if(k==="1"){m=c("#redactor_link_url").val();a=c("#redactor_link_url_text").val();if(c("#redactor_link_blank").prop("checked")){o=' target="_blank"';b="_blank"}var l="/(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/";var n=new RegExp("^(http|ftp|https)://"+l,"i");var p=new RegExp("^"+l,"i");if(m.search(n)==-1&&m.search(p)==0&&this.opts.protocol!==false){m=this.opts.protocol+m}}else{if(k==="2"){m="mailto:"+c("#redactor_link_mailto").val();a=c("#redactor_link_mailto_text").val()}else{if(k==="3"){m="#"+c("#redactor_link_anchor").val();a=c("#redactor_link_anchor_text").val()}}}this._insertLink('<a href="'+m+'"'+o+">"+a+"</a>",c.trim(a),m,b)},_insertLink:function(h,a,g,b){this.$editor.focus();this.restoreSelection();if(a!==""){if(this.insert_link_node){c(this.insert_link_node).text(a);c(this.insert_link_node).attr("href",g);if(b!==""){c(this.insert_link_node).attr("target",b)}else{c(this.insert_link_node).removeAttr("target")}this.syncCode()}else{this.execCommand("inserthtml",h)}}this.modalClose()},showFile:function(){this.saveSelection();var a=c.proxy(function(){var f=this.getSelection();var b="";if(this.oldIE()){b=f.text}else{b=f.toString()}c("#redactor_filename").val(b);if(this.opts.uploadCrossDomain===false&&this.isMobile()===false){c("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:c.proxy(this.fileUploadCallback,this),error:c.proxy(this.opts.fileUploadErrorCallback,this)})}this.uploadInit("redactor_file",{auto:true,url:this.opts.fileUpload,success:c.proxy(this.fileUploadCallback,this),error:c.proxy(this.opts.fileUploadErrorCallback,this)})},this);this.modalInit(RLANG.file,this.opts.modal_file,500,a)},fileUploadCallback:function(f){this.restoreSelection();if(f!==false){var a=c("#redactor_filename").val();if(a===""){a=f.filename}var b='<a href="'+f.filelink+'">'+a+"</a>";if(this.browser("webkit")&&!!this.window.chrome){b=b+"&nbsp;"}this.execCommand("inserthtml",b);if(typeof this.opts.fileUploadCallback==="function"){this.opts.fileUploadCallback(this,f)}}this.modalClose()},modalInit:function(b,h,j,a){if(c("#redactor_modal_overlay").size()===0){this.overlay=c('<div id="redactor_modal_overlay" style="display: none;"></div>');c("body").prepend(this.overlay)}if(this.opts.overlay){c("#redactor_modal_overlay").show();c("#redactor_modal_overlay").click(c.proxy(this.modalClose,this))}if(c("#redactor_modal").size()===0){this.modal=c('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>');c("body").append(this.modal)}c("#redactor_modal_close").click(c.proxy(this.modalClose,this));this.hdlModalClose=c.proxy(function(e){if(e.keyCode===27){this.modalClose();return false}},this);c(document).keyup(this.hdlModalClose);this.$editor.keyup(this.hdlModalClose);if(h.indexOf("#")==0){c("#redactor_modal_inner").empty().append(c(h).html())}else{c("#redactor_modal_inner").empty().append(h)}c("#redactor_modal_header").html(b);if(typeof c.fn.draggable!=="undefined"){c("#redactor_modal").draggable({handle:"#redactor_modal_header"});c("#redactor_modal_header").css("cursor","move")}if(c("#redactor_tabs").size()!==0){var i=this;c("#redactor_tabs a").each(function(f,e){f++;c(e).click(function(){c("#redactor_tabs a").removeClass("redactor_tabs_act");c(this).addClass("redactor_tabs_act");c(".redactor_tab").hide();c("#redactor_tab"+f).show();c("#redactor_tab_selected").val(f);if(i.isMobile()===false){var g=c("#redactor_modal").outerHeight();c("#redactor_modal").css("margin-top","-"+(g+10)/2+"px")}})})}c("#redactor_modal .redactor_btn_modal_close").click(c.proxy(this.modalClose,this));if(this.isMobile()===false){c("#redactor_modal").css({position:"fixed",top:"-2000px",left:"50%",width:j+"px",marginLeft:"-"+(j+60)/2+"px"}).show();this.modalSaveBodyOveflow=c(document.body).css("overflow");c(document.body).css("overflow","hidden")}else{c("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show()}if(typeof a==="function"){a()}if(this.isMobile()===false){setTimeout(function(){var e=c("#redactor_modal").outerHeight();c("#redactor_modal").css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)}},modalClose:function(){c("#redactor_modal_close").unbind("click",this.modalClose);c("#redactor_modal").fadeOut("fast",c.proxy(function(){c("#redactor_modal_inner").html("");if(this.opts.overlay){c("#redactor_modal_overlay").hide();c("#redactor_modal_overlay").unbind("click",this.modalClose)}c(document).unbind("keyup",this.hdlModalClose);this.$editor.unbind("keyup",this.hdlModalClose)},this));if(this.isMobile()===false){c(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible")}return false},setModalTab:function(b){c(".redactor_tab").hide();var a=c("#redactor_tabs a");a.removeClass("redactor_tabs_act");a.eq(b-1).addClass("redactor_tabs_act");c("#redactor_tab"+b).show()},uploadInit:function(a,b){this.uploadOptions={url:false,success:false,error:false,start:false,trigger:false,auto:false,input:false};c.extend(this.uploadOptions,b);if(c("#"+a).size()!==0&&c("#"+a).get(0).tagName==="INPUT"){this.uploadOptions.input=c("#"+a);this.element=c(c("#"+a).get(0).form)}else{this.element=c("#"+a)}this.element_action=this.element.attr("action");if(this.uploadOptions.auto){c(this.uploadOptions.input).change(c.proxy(function(){this.element.submit(function(e){return false});this.uploadSubmit()},this))}else{if(this.uploadOptions.trigger){c("#"+this.uploadOptions.trigger).click(c.proxy(this.uploadSubmit,this))}}},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(Math.random()*99999);var a=this.document.createElement("div");var b='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';a.innerHTML=b;c(a).appendTo("body");if(this.uploadOptions.start){this.uploadOptions.start()}c("#"+this.id).load(c.proxy(this.uploadLoaded,this));return this.id},uploadForm:function(f,j){if(this.uploadOptions.input){var b="redactorUploadForm"+this.id;var l="redactorUploadFile"+this.id;this.form=c('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+j+'" name="'+b+'" id="'+b+'" enctype="multipart/form-data"></form>');if(this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"){c.each(this.opts.uploadFields,c.proxy(function(g,h){if(h.toString().indexOf("#")===0){h=c(h).val()}var e=c("<input/>",{type:"hidden",name:g,value:h});c(this.form).append(e)},this))}var k=this.uploadOptions.input;var a=c(k).clone();c(k).attr("id",l);c(k).before(a);c(k).appendTo(this.form);c(this.form).css("position","absolute");c(this.form).css("top","-2000px");c(this.form).css("left","-2000px");c(this.form).appendTo("body");this.form.submit()}else{f.attr("target",j);f.attr("method","POST");f.attr("enctype","multipart/form-data");f.attr("action",this.uploadOptions.url);this.element.submit()}},uploadLoaded:function(){var b=c("#"+this.id)[0];var a;if(b.contentDocument){a=b.contentDocument}else{if(b.contentWindow){a=b.contentWindow.document}else{a=window.frames[this.id].document}}if(this.uploadOptions.success){if(typeof a!=="undefined"){var i=a.body.innerHTML;var j=i.match(/\{(.|\n)*\}/)[0];var k=c.parseJSON(j);if(typeof k.error=="undefined"){this.uploadOptions.success(k)}else{this.uploadOptions.error(this,k);this.modalClose()}}else{alert("Upload failed!");this.modalClose()}}this.element.attr("action",this.element_action);this.element.attr("target","")},browser:function(b){var a=navigator.userAgent.toLowerCase();var f=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];if(b=="version"){return f[2]}if(b=="webkit"){return(f[1]=="chrome"||f[1]=="webkit")}return f[1]==b},oldIE:function(){if(this.browser("msie")&&parseInt(this.browser("version"),10)<9){return true}return false},outerHTML:function(a){return c("<p>").append(c(a).eq(0).clone()).html()},normalize:function(a){return parseInt(a.replace("px",""),10)},isMobile:function(a){if(a===true&&/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{if(/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)){return true}else{return false}}}};c.fn.getObject=function(){return this.data("redactor")};c.fn.getEditor=function(){return this.data("redactor").$editor};c.fn.getCode=function(){return c.trim(this.data("redactor").getCode())};c.fn.getText=function(){return this.data("redactor").$editor.text()};c.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()};c.fn.setCode=function(a){this.data("redactor").setCode(a)};c.fn.insertHtml=function(a){this.data("redactor").insertHtml(a)};c.fn.destroyEditor=function(){this.each(function(){if(typeof c(this).data("redactor")!="undefined"){c(this).data("redactor").destroy();c(this).removeData("redactor")}})};c.fn.setFocus=function(){this.data("redactor").$editor.focus()};c.fn.execCommand=function(b,a){this.data("redactor").execCommand(b,a)}})(jQuery);(function(c){c.fn.dragupload=function(a){return this.each(function(){var b=new d(this,a);b.init()})};function d(a,b){this.opts=c.extend({url:false,success:false,error:false,preview:false,uploadFields:false,text:RLANG.drop_file_here,atext:RLANG.or_choose},b);this.$el=c(a)}d.prototype={init:function(){if(navigator.userAgent.search("MSIE")===-1){this.droparea=c('<div class="redactor_droparea"></div>');this.dropareabox=c('<div class="redactor_dropareabox">'+this.opts.text+"</div>");this.dropalternative=c('<div class="redactor_dropalternative">'+this.opts.atext+"</div>");this.droparea.append(this.dropareabox);this.$el.before(this.droparea);this.$el.before(this.dropalternative);this.dropareabox.bind("dragover",c.proxy(function(){return this.ondrag()},this));this.dropareabox.bind("dragleave",c.proxy(function(){return this.ondragleave()},this));var a=c.proxy(function(e){var h=parseInt(e.loaded/e.total*100,10);this.dropareabox.text("Loading "+h+"%")},this);var b=jQuery.ajaxSettings.xhr();if(b.upload){b.upload.addEventListener("progress",a,false)}var f=function(){return b};this.dropareabox.get(0).ondrop=c.proxy(function(e){e.preventDefault();this.dropareabox.removeClass("hover").addClass("drop");var i=e.dataTransfer.files[0];var j=new FormData();if(this.opts.uploadFields!==false&&typeof this.opts.uploadFields==="object"){c.each(this.opts.uploadFields,c.proxy(function(g,h){if(h.toString().indexOf("#")===0){h=c(h).val()}j.append(g,h)},this))}j.append("file",i);c.ajax({url:this.opts.url,dataType:"html",data:j,xhr:f,cache:false,contentType:false,processData:false,type:"POST",success:c.proxy(function(g){var h=c.parseJSON(g);if(typeof h.error=="undefined"){this.opts.success(h)}else{this.opts.error(this,h);this.opts.success(false)}},this)})},this)}},ondrag:function(){this.dropareabox.addClass("hover");return false},ondragleave:function(){this.dropareabox.removeClass("hover");return false}}})(jQuery);(function(f){var h="http://";var i=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,g=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,j=function(){var b=this.childNodes,c=b.length;while(c--){var a=b[c];if(a.nodeType===3){var d=a.nodeValue;if(d){d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,'$1<a href="'+h+'$2">$2</a>$3').replace(g,'$1<a href="$2">$2</a>$5');f(a).after(d).remove()}}else{if(a.nodeType===1&&!/^(a|button|textarea)$/i.test(a.tagName)){j.call(a)}}}};f.fn.linkify=function(){this.each(j)}})(jQuery);(function(b){b.event.special.textselect={setup:function(d,a){b(this).data("textselected",false);b(this).data("ttt",d);b(this).on("mouseup",b.event.special.textselect.handler)},teardown:function(a){b(this).off("mouseup",b.event.special.textselect.handler)},handler:function(a){var f=b(this).data("ttt");var e=b.event.special.textselect.getSelectedText(f).toString();if(e!=""){b(this).data("textselected",true);a.type="textselect";a.text=e;b.event.dispatch.apply(this,arguments)}},getSelectedText:function(a){var d="";if(rwindow.getSelection){d=rwindow.getSelection()}else{if(rdocument.getSelection){d=rdocument.getSelection()}else{if(rdocument.selection){d=rdocument.selection.createRange().text}}}return d}};b.event.special.textunselect={setup:function(d,a){b(this).data("rttt",d);b(this).data("textselected",false);b(this).on("mouseup",b.event.special.textunselect.handler);b(this).on("keyup",b.event.special.textunselect.handlerKey)},teardown:function(a){b(this).unbind("mouseup",b.event.special.textunselect.handler)},handler:function(a){if(b(this).data("textselected")){var f=b(this).data("rttt");var e=b.event.special.textselect.getSelectedText(f).toString();if(e==""){b(this).data("textselected",false);a.type="textunselect";b.event.dispatch.apply(this,arguments)}}},handlerKey:function(a){if(b(this).data("textselected")){var f=b(this).data("rttt");var e=b.event.special.textselect.getSelectedText(f).toString();if((a.keyCode=27)&&(e=="")){b(this).data("textselected",false);a.type="textunselect";b.event.dispatch.apply(this,arguments)}}}}})(jQuery);

/* jQuery plugin textselect
 * version: 0.9
 * author: Josef Moravec, josef.moravec@gmail.com
 * updated: Imperavi Inc.
 */
eval(function(p,a,c,k,e,d){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--){d[e(c)]=k[c]||e(c)}k=[function(e){return d[e]}];e=function(){return'\\w+'};c=1};while(c--){if(k[c]){p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c])}}return p}('(5($){$.1.4.7={t:5(0,v){$(2).0("8",c);$(2).0("r",0);$(2).l(\'g\',$.1.4.7.b)},u:5(0){$(2).w(\'g\',$.1.4.7.b)},b:5(1){9 0=$(2).0("r");9 3=$.1.4.7.f(0).h();6(3!=\'\'){$(2).0("8",x);1.j="7";1.3=3;$.1.i.m(2,k)}},f:5(0){9 3=\'\';6(q.e){3=q.e()}o 6(d.e){3=d.e()}o 6(d.p){3=d.p.B().3}A 3}};$.1.4.a={t:5(0,v){$(2).0("n",0);$(2).0("8",c);$(2).l(\'g\',$.1.4.a.b);$(2).l(\'D\',$.1.4.a.s)},u:5(0){$(2).w(\'g\',$.1.4.a.b)},b:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6(3==\'\'){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}},s:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6((1.y=z)&&(3==\'\')){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}}}})(C);',40,40,'data|event|this|text|special|function|if|textselect|textselected|var|textunselect|handler|false|rdocument|getSelection|getSelectedText|mouseup|toString|handle|type|arguments|bind|apply|rttt|else|selection|rwindow|ttt|handlerKey|setup|teardown|namespaces|unbind|true|keyCode|27|return|createRange|jQuery|keyup'.split('|'),0,{}))


/*!
 * Fine Uploader
 * Copyright 2013, Widen Enterprises, Inc. info@fineuploader.com
 * Version: 3.7.0
 */ 
var qq=function(a){"use strict";return{hide:function(){return a.style.display="none",this},attach:function(b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c),function(){qq(a).detach(b,c)}},detach:function(b,c){return a.removeEventListener?a.removeEventListener(b,c,!1):a.attachEvent&&a.detachEvent("on"+b,c),this},contains:function(b){return b?a===b?!0:a.contains?a.contains(b):!!(8&b.compareDocumentPosition(a)):!1},insertBefore:function(b){return b.parentNode.insertBefore(a,b),this},remove:function(){return a.parentNode.removeChild(a),this},css:function(b){return null!=b.opacity&&"string"!=typeof a.style.opacity&&"undefined"!=typeof a.filters&&(b.filter="alpha(opacity="+Math.round(100*b.opacity)+")"),qq.extend(a.style,b),this},hasClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return c.test(a.className)},addClass:function(b){return qq(a).hasClass(b)||(a.className+=" "+b),this},removeClass:function(b){var c=new RegExp("(^| )"+b+"( |$)");return a.className=a.className.replace(c," ").replace(/^\s+|\s+$/g,""),this},getByClass:function(b){var c,d=[];return a.querySelectorAll?a.querySelectorAll("."+b):(c=a.getElementsByTagName("*"),qq.each(c,function(a,c){qq(c).hasClass(b)&&d.push(c)}),d)},children:function(){for(var b=[],c=a.firstChild;c;)1===c.nodeType&&b.push(c),c=c.nextSibling;return b},setText:function(b){return a.innerText=b,a.textContent=b,this},clearText:function(){return qq(a).setText("")}}};qq.log=function(a,b){"use strict";window.console&&(b&&"info"!==b?window.console[b]?window.console[b](a):window.console.log("<"+b+"> "+a):window.console.log(a))},qq.isObject=function(a){"use strict";return a&&!a.nodeType&&"[object Object]"===Object.prototype.toString.call(a)},qq.isFunction=function(a){"use strict";return"function"==typeof a},qq.isArray=function(a){"use strict";return"[object Array]"===Object.prototype.toString.call(a)},qq.isString=function(a){"use strict";return"[object String]"===Object.prototype.toString.call(a)},qq.trimStr=function(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")},qq.format=function(a){"use strict";var b=Array.prototype.slice.call(arguments,1),c=a;return qq.each(b,function(a,b){c=c.replace(/{}/,b)}),c},qq.isFile=function(a){"use strict";return window.File&&"[object File]"===Object.prototype.toString.call(a)},qq.isFileList=function(a){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(a)},qq.isFileOrInput=function(a){"use strict";return qq.isFile(a)||qq.isInput(a)},qq.isInput=function(a){return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(a)&&a.type&&"file"===a.type.toLowerCase()?!0:a.tagName&&"input"===a.tagName.toLowerCase()&&a.type&&"file"===a.type.toLowerCase()?!0:!1},qq.isBlob=function(a){"use strict";return window.Blob&&"[object Blob]"===Object.prototype.toString.call(a)},qq.isXhrUploadSupported=function(){"use strict";var a=document.createElement("input");return a.type="file",void 0!==a.multiple&&"undefined"!=typeof File&&"undefined"!=typeof FormData&&"undefined"!=typeof(new XMLHttpRequest).upload},qq.isFolderDropSupported=function(a){"use strict";return a.items&&a.items[0].webkitGetAsEntry},qq.isFileChunkingSupported=function(){"use strict";return!qq.android()&&qq.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)},qq.extend=function(a,b,c){"use strict";return qq.each(b,function(b,d){c&&qq.isObject(d)?(void 0===a[b]&&(a[b]={}),qq.extend(a[b],d,!0)):a[b]=d}),a},qq.indexOf=function(a,b,c){"use strict";if(a.indexOf)return a.indexOf(b,c);c=c||0;var d=a.length;for(0>c&&(c+=d);d>c;c+=1)if(a.hasOwnProperty(c)&&a[c]===b)return c;return-1},qq.getUniqueId=function(){"use strict";return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})},qq.ie=function(){"use strict";return-1!==navigator.userAgent.indexOf("MSIE")},qq.ie10=function(){"use strict";return-1!==navigator.userAgent.indexOf("MSIE 10")},qq.safari=function(){"use strict";return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")},qq.chrome=function(){"use strict";return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")},qq.firefox=function(){"use strict";return-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor},qq.windows=function(){"use strict";return"Win32"===navigator.platform},qq.android=function(){"use strict";return-1!==navigator.userAgent.toLowerCase().indexOf("android")},qq.ios=function(){"use strict";return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")},qq.preventDefault=function(a){"use strict";a.preventDefault?a.preventDefault():a.returnValue=!1},qq.toElement=function(){"use strict";var a=document.createElement("div");return function(b){a.innerHTML=b;var c=a.firstChild;return a.removeChild(c),c}}(),qq.each=function(a,b){"use strict";var c,d;if(a)if(qq.isArray(a))for(c=0;c<a.length&&(d=b(c,a[c]),d!==!1);c++);else for(c in a)if(Object.prototype.hasOwnProperty.call(a,c)&&(d=b(c,a[c]),d===!1))break},qq.bind=function(a,b){if(qq.isFunction(a)){var c=Array.prototype.slice.call(arguments,2);return function(){return arguments.length&&(c=c.concat(Array.prototype.slice.call(arguments))),a.apply(b,c)}}throw new Error("first parameter must be a function!")},qq.obj2url=function(a,b,c){"use strict";var d,e,f=[],g="&",h=function(a,c){var d=b?/\[\]$/.test(b)?b:b+"["+c+"]":c;"undefined"!==d&&"undefined"!==c&&f.push("object"==typeof a?qq.obj2url(a,d,!0):"[object Function]"===Object.prototype.toString.call(a)?encodeURIComponent(d)+"="+encodeURIComponent(a()):encodeURIComponent(d)+"="+encodeURIComponent(a))};if(!c&&b)g=/\?/.test(b)?/\?$/.test(b)?"":"&":"?",f.push(b),f.push(qq.obj2url(a));else if("[object Array]"===Object.prototype.toString.call(a)&&"undefined"!=typeof a)for(d=-1,e=a.length;e>d;d+=1)h(a[d],d);else if("undefined"!=typeof a&&null!==a&&"object"==typeof a)for(d in a)a.hasOwnProperty(d)&&h(a[d],d);else f.push(encodeURIComponent(b)+"="+encodeURIComponent(a));return b?f.join(g):f.join(g).replace(/^&/,"").replace(/%20/g,"+")},qq.obj2FormData=function(a,b,c){"use strict";return b||(b=new FormData),qq.each(a,function(a,d){a=c?c+"["+a+"]":a,qq.isObject(d)?qq.obj2FormData(d,b,a):qq.isFunction(d)?b.append(a,d()):b.append(a,d)}),b},qq.obj2Inputs=function(a,b){"use strict";var c;return b||(b=document.createElement("form")),qq.obj2FormData(a,{append:function(a,d){c=document.createElement("input"),c.setAttribute("name",a),c.setAttribute("value",d),b.appendChild(c)}}),b},qq.setCookie=function(a,b,c){var d=new Date,e="";c&&(d.setTime(d.getTime()+1e3*60*60*24*c),e="; expires="+d.toGMTString()),document.cookie=a+"="+b+e+"; path=/"},qq.getCookie=function(a){var b,c=a+"=",d=document.cookie.split(";");return qq.each(d,function(a,d){for(var e=d;" "==e.charAt(0);)e=e.substring(1,e.length);return 0===e.indexOf(c)?(b=e.substring(c.length,e.length),!1):void 0}),b},qq.getCookieNames=function(a){var b=document.cookie.split(";"),c=[];return qq.each(b,function(b,d){d=qq.trimStr(d);var e=d.indexOf("=");d.match(a)&&c.push(d.substr(0,e))}),c},qq.deleteCookie=function(a){qq.setCookie(a,"",-1)},qq.areCookiesEnabled=function(){var a=1e5*Math.random(),b="qqCookieTest:"+a;return qq.setCookie(b,1),qq.getCookie(b)?(qq.deleteCookie(b),!0):!1},qq.parseJson=function(json){return window.JSON&&qq.isFunction(JSON.parse)?JSON.parse(json):eval("("+json+")")},qq.DisposeSupport=function(){"use strict";var a=[];return{dispose:function(){var b;do b=a.shift(),b&&b();while(b)},attach:function(){var a=arguments;this.addDisposer(qq(a[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}},qq.version="3.7.0",qq.supportedFeatures=function(){function a(){var a,b=!0;try{a=document.createElement("input"),a.type="file",qq(a).hide(),a.disabled&&(b=!1)}catch(c){b=!1}return b}function b(){return qq.chrome()&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/)}function c(){return qq.chrome()&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/)}function d(){if(window.XMLHttpRequest){var a=new XMLHttpRequest;return void 0!==a.withCredentials}return!1}function e(){return void 0!==window.XDomainRequest}function f(){return d()?!0:e()}var g,h,i,j,k,l,m,n,o,p;return g=a(),h=g&&qq.isXhrUploadSupported(),i=h&&b(),j=h&&qq.isFileChunkingSupported(),k=h&&j&&qq.areCookiesEnabled(),l=h&&c(),m=g&&(void 0!==window.postMessage||h),o=d(),n=e(),p=f(),{uploading:g,ajaxUploading:h,fileDrop:h,folderDrop:i,chunking:j,resume:k,uploadCustomHeaders:h,uploadNonMultipart:h,itemSizeValidation:h,uploadViaPaste:l,progressBar:h,uploadCors:m,deleteFileCorsXhr:o,deleteFileCorsXdr:n,deleteFileCors:p,canDetermineSize:h}}(),qq.Promise=function(){"use strict";var a,b,c=[],d=[],e=[],f=0;return{then:function(e,g){return 0===f?(e&&c.push(e),g&&d.push(g)):-1===f&&g?g(b):e&&e(a),this},done:function(a){return 0===f?e.push(a):a(),this},success:function(b){return f=1,a=b,c.length&&qq.each(c,function(a,c){c(b)}),e.length&&qq.each(e,function(a,b){b()}),this},failure:function(a){return f=-1,b=a,d.length&&qq.each(d,function(b,c){c(a)}),e.length&&qq.each(e,function(a,b){b()}),this}}},qq.isPromise=function(a){return a&&a.then&&a.done},qq.UploadButton=function(a){"use strict";function b(){var a=document.createElement("input");return e.multiple&&a.setAttribute("multiple","multiple"),e.acceptFiles&&a.setAttribute("accept",e.acceptFiles),a.setAttribute("type","file"),a.setAttribute("name",e.name),qq(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,padding:0,cursor:"pointer",opacity:0}),e.element.appendChild(a),d.attach(a,"change",function(){e.onChange(a)}),d.attach(a,"mouseover",function(){qq(e.element).addClass(e.hoverClass)}),d.attach(a,"mouseout",function(){qq(e.element).removeClass(e.hoverClass)}),d.attach(a,"focus",function(){qq(e.element).addClass(e.focusClass)}),d.attach(a,"blur",function(){qq(e.element).removeClass(e.focusClass)}),window.attachEvent&&a.setAttribute("tabIndex","-1"),a}var c,d=new qq.DisposeSupport,e={element:null,multiple:!1,acceptFiles:null,name:"qqfile",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};return qq.extend(e,a),qq(e.element).css({position:"relative",overflow:"hidden",direction:"ltr"}),c=b(),{getInput:function(){return c},reset:function(){c.parentNode&&qq(c).remove(),qq(e.element).removeClass(e.focusClass),c=b()}}},qq.PasteSupport=function(a){"use strict";function b(a){return a.type&&0===a.type.indexOf("image/")}function c(){qq(e.targetElement).attach("paste",function(a){var c=a.clipboardData;c&&qq.each(c.items,function(a,c){if(b(c)){var d=c.getAsFile();e.callbacks.pasteReceived(d)}})})}function d(){f&&f()}var e,f;return e={targetElement:null,callbacks:{log:function(){},pasteReceived:function(){}}},qq.extend(e,a),c(),{reset:function(){d()}}},qq.UploadData=function(a){function b(a){if(qq.isArray(a)){var b=[];return qq.each(a,function(a,c){b.push(f[g[c]])}),b}return f[g[a]]}function c(a){if(qq.isArray(a)){var b=[];return qq.each(a,function(a,c){b.push(f[h[c]])}),b}return f[h[a]]}function d(a){var b=[],c=[].concat(a);return qq.each(c,function(a,c){var d=i[c];void 0!==d&&qq.each(d,function(a,c){b.push(f[c])})}),b}var e,f=[],g={},h={},i={};return e={added:function(b){var c=a.getUuid(b),d=a.getName(b),e=a.getSize(b),j=qq.status.SUBMITTING,k=f.push({id:b,name:d,originalName:d,uuid:c,size:e,status:j})-1;g[b]=k,h[c]=k,void 0===i[j]&&(i[j]=[]),i[j].push(k),a.onStatusChange(b,void 0,j)},retrieve:function(a){return qq.isObject(a)&&f.length?void 0!==a.id?b(a.id):void 0!==a.uuid?c(a.uuid):a.status?d(a.status):void 0:qq.extend([],f,!0)},reset:function(){f=[],g={},h={},i={}},setStatus:function(b,c){var d=g[b],e=f[d].status,h=qq.indexOf(i[e],d);i[e].splice(h,1),f[d].status=c,void 0===i[c]&&(i[c]=[]),i[c].push(d),a.onStatusChange(b,e,c)},uuidChanged:function(a,b){var c=g[a],d=f[c].uuid;f[c].uuid=b,h[b]=c,delete h[d]},nameChanged:function(a,b){var c=g[a];f[c].name=b}}},qq.status={SUBMITTING:"提交中",SUBMITTED: "提交",REJECTED: "放弃",QUEUED: "队列",CANCELED: "取消",UPLOADING: "上传",UPLOAD_RETRYING: "重新上传",UPLOAD_SUCCESSFUL: "上传成功",UPLOAD_FAILED: "上传成功",
 DELETE_FAILED: "上传失败",DELETING: "删除中",DELETED: "删除"},qq.FineUploaderBasic=function(a){this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{endpoint:"/server/upload",params:{},paramsInBody:!0,customHeaders:{},forceMultipart:!0,inputName:"qqfile",uuidName:"qquuid",totalFileSizeName:"qqtotalfilesize",filenameParam:"qqfilename"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null},callbacks:{onSubmit:function(){},onSubmitted:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onResume:function(){},onProgress:function(){},onError:function(){},onAutoRetry:function(){},onManualRetry:function(){},onValidateBatch:function(){},onValidate:function(){},onSubmitDelete:function(){},onDelete:function(){},onDeleteComplete:function(){},onPasteReceived:function(){},onStatusChange:function(){}},messages:{typeError: "{file}无效文件,允许上传格式:{extensions}.",sizeError:"{file}文件太大, 允许最大文件 {sizeLimit}.",minSizeError: "{file}文件太小,允许最小文件{minSizeLimit}.",emptyError:"{file}是空的,请选择文件.",noFilesError:"无上传文件!",
tooManyItemsError: "上传数({netItems})超最大队列数!允许同时上传数{itemLimit}.",retryFailTooManyItems:"重试失败!你已经达到最大限制",onLeave: "文件上传中, 如果离开当前页，上传将终止."},retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},formatFileName:function(a){return void 0!==a&&a.length>33&&(a=a.slice(0,19)+"..."+a.slice(-14)),a},text:{defaultResponseError:"Upload failure reason unknown",sizeSymbols:["kB","MB","GB","TB","PB","EB"]},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1}},qq.extend(this._options,a,!0),this._handleCameraAccess(),this._wrapCallbacks(),this._disposeSupport=new qq.DisposeSupport,this._filesInProgress=[],this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData=this._createUploadDataTracker(),this._paramsStore=this._createParamsStore("request"),this._deleteFileParamsStore=this._createParamsStore("deleteFile"),this._endpointStore=this._createEndpointStore("request"),this._deleteFileEndpointStore=this._createEndpointStore("deleteFile"),this._handler=this._createUploadHandler(),this._deleteHandler=this._createDeleteHandler(),this._options.button&&(this._button=this._createUploadButton(this._options.button)),this._options.paste.targetElement&&(this._pasteHandler=this._createPasteHandler()),this._preventLeaveInProgress()},qq.FineUploaderBasic.prototype={log:function(a,b){!this._options.debug||b&&"info"!==b?b&&"info"!==b&&qq.log("[FineUploader "+qq.version+"] "+a,b):qq.log("[FineUploader "+qq.version+"] "+a)},setParams:function(a,b){null==b?this._options.request.params=a:this._paramsStore.setParams(a,b)},setDeleteFileParams:function(a,b){null==b?this._options.deleteFile.params=a:this._deleteFileParamsStore.setParams(a,b)},setEndpoint:function(a,b){null==b?this._options.request.endpoint=a:this._endpointStore.setEndpoint(a,b)},getInProgress:function(){return this._filesInProgress.length},getNetUploads:function(){return this._netUploaded},uploadStoredFiles:function(){var a;if(0===this._storedIds.length)this._itemError("noFilesError");else for(;this._storedIds.length;)a=this._storedIds.shift(),this._filesInProgress.push(a),this._handler.upload(a)},clearStoredFiles:function(){this._storedIds=[]},retry:function(a){return this._onBeforeManualRetry(a)?(this._netUploadedOrQueued++,this._uploadData.setStatus(a,qq.status.UPLOAD_RETRYING),this._handler.retry(a),!0):!1},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var a=[],b=this;qq.extend(a,this._storedIds),qq.each(a,function(a,c){b.cancel(c)}),this._handler.cancelAll()},reset:function(){this.log("Resetting uploader..."),this._handler.reset(),this._filesInProgress=[],this._storedIds=[],this._autoRetries=[],this._retryTimeouts=[],this._preventRetries=[],this._button.reset(),this._paramsStore.reset(),this._endpointStore.reset(),this._netUploadedOrQueued=0,this._netUploaded=0,this._uploadData.reset(),this._pasteHandler&&this._pasteHandler.reset()},addFiles:function(a,b,c){var d,e,f,g=this,h=[];if(a){for(qq.isFileList(a)||(a=[].concat(a)),d=0;d<a.length;d+=1)if(e=a[d],qq.isFileOrInput(e))if(qq.isInput(e)&&qq.supportedFeatures.ajaxUploading)for(f=0;f<e.files.length;f++)h.push(e.files[f]);else h.push(e);else g.log(e+" is not a File or INPUT element!  Ignoring!","warn");this.log("Received "+h.length+" files or inputs."),this._prepareItemsForUpload(h,b,c)}},addBlobs:function(a,b,c){if(a){var d=[].concat(a),e=[],f=this;qq.each(d,function(a,b){qq.isBlob(b)&&!qq.isFileOrInput(b)?e.push({blob:b,name:f._options.blobs.defaultName}):qq.isObject(b)&&b.blob&&b.name?e.push(b):f.log("addBlobs: entry at index "+a+" is not a Blob or a BlobData object","error")}),this._prepareItemsForUpload(e,b,c)}else this.log("undefined or non-array parameter passed into addBlobs","error")},getUuid:function(a){return this._handler.getUuid(a)},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._handler.getSize(a)},getName:function(a){return this._handler.getName(a)},setName:function(a,b){this._handler.setName(a,b),this._uploadData.nameChanged(a,b)},getFile:function(a){return this._handler.getFile(a)},deleteFile:function(a){this._onSubmitDelete(a)},setDeleteFileEndpoint:function(a,b){null==b?this._options.deleteFile.endpoint=a:this._deleteFileEndpointStore.setEndpoint(a,b)},doesExist:function(a){return this._handler.isValid(a)},getUploads:function(a){return this._uploadData.retrieve(a)},_handleCheckedCallback:function(a){var b=this,c=a.callback();return qq.isPromise(c)?(this.log(a.name+" - waiting for "+a.name+" promise to be fulfilled for "+a.identifier),c.then(function(c){b.log(a.name+" promise success for "+a.identifier),a.onSuccess(c)},function(){a.onFailure?(b.log(a.name+" promise failure for "+a.identifier),a.onFailure()):b.log(a.name+" promise failure for "+a.identifier)})):(c!==!1?a.onSuccess(c):a.onFailure?(this.log(a.name+" - return value was 'false' for "+a.identifier+".  Invoking failure callback."),a.onFailure()):this.log(a.name+" - return value was 'false' for "+a.identifier+".  Will not proceed."),c)},_createUploadButton:function(a){var b=this,c=new qq.UploadButton({element:a,multiple:this._options.multiple&&qq.supportedFeatures.ajaxUploading,acceptFiles:this._options.validation.acceptFiles,onChange:function(a){b._onInputChange(a)},hoverClass:this._options.classes.buttonHover,focusClass:this._options.classes.buttonFocus});return this._disposeSupport.addDisposer(function(){c.dispose()}),c},_createUploadHandler:function(){var a=this;return new qq.UploadHandler({debug:this._options.debug,forceMultipart:this._options.request.forceMultipart,maxConnections:this._options.maxConnections,customHeaders:this._options.request.customHeaders,inputName:this._options.request.inputName,uuidParamName:this._options.request.uuidName,filenameParam:this._options.request.filenameParam,totalFileSizeParamName:this._options.request.totalFileSizeName,cors:this._options.cors,demoMode:this._options.demoMode,paramsInBody:this._options.request.paramsInBody,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:function(b,c){a.log(b,c)},onProgress:function(b,c,d,e){a._onProgress(b,c,d,e),a._options.callbacks.onProgress(b,c,d,e)},onComplete:function(b,c,d,e){a._onComplete(b,c,d,e),a._options.callbacks.onComplete(b,c,d,e)},onCancel:function(b,c){return a._handleCheckedCallback({name:"onCancel",callback:qq.bind(a._options.callbacks.onCancel,a,b,c),onSuccess:qq.bind(a._onCancel,a,b,c),identifier:b})},onUpload:function(b,c){a._onUpload(b,c),a._options.callbacks.onUpload(b,c)},onUploadChunk:function(b,c,d){a._options.callbacks.onUploadChunk(b,c,d)},onResume:function(b,c,d){return a._options.callbacks.onResume(b,c,d)},onAutoRetry:function(b,c,d,e){return a._preventRetries[b]=d[a._options.retry.preventRetryResponseProperty],a._shouldAutoRetry(b,c,d)?(a._maybeParseAndSendUploadError(b,c,d,e),a._options.callbacks.onAutoRetry(b,c,a._autoRetries[b]+1),a._onBeforeAutoRetry(b,c),a._retryTimeouts[b]=setTimeout(function(){a._onAutoRetry(b,c,d)},1e3*a._options.retry.autoAttemptDelay),!0):!1},onUuidChanged:function(b,c){a._uploadData.uuidChanged(b,c)}})},_createDeleteHandler:function(){var a=this;return new qq.DeleteFileAjaxRequestor({method:this._options.deleteFile.method,maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._options.deleteFile.customHeaders,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,demoMode:this._options.demoMode,cors:this._options.cors,log:function(b,c){a.log(b,c)},onDelete:function(b){a._onDelete(b),a._options.callbacks.onDelete(b)},onDeleteComplete:function(b,c,d){a._onDeleteComplete(b,c,d),a._options.callbacks.onDeleteComplete(b,c,d)}})},_createPasteHandler:function(){var a=this;return new qq.PasteSupport({targetElement:this._options.paste.targetElement,callbacks:{log:function(b,c){a.log(b,c)},pasteReceived:function(b){a._handleCheckedCallback({name:"onPasteReceived",callback:qq.bind(a._options.callbacks.onPasteReceived,a,b),onSuccess:qq.bind(a._handlePasteSuccess,a,b),identifier:"pasted image"})}}})},_createUploadDataTracker:function(){var a=this;return new qq.UploadData({getName:function(b){return a.getName(b)},getUuid:function(b){return a.getUuid(b)},getSize:function(b){return a.getSize(b)},onStatusChange:function(b,c,d){a._onUploadStatusChange(b,c,d),a._options.callbacks.onStatusChange(b,c,d)}})},_onUploadStatusChange:function(){},_handlePasteSuccess:function(a,b){var c=a.type.split("/")[1],d=b;null==d&&(d=this._options.paste.defaultName),d+="."+c,this.addBlobs({name:d,blob:a})},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,"beforeunload",function(b){if(a._filesInProgress.length){var b=b||window.event;return b.returnValue=a._options.messages.onLeave,a._options.messages.onLeave}})},_onSubmit:function(a){this._netUploadedOrQueued++,this._options.autoUpload&&this._filesInProgress.push(a)},_onProgress:function(){},_onComplete:function(a,b,c,d){c.success?(this._netUploaded++,this._uploadData.setStatus(a,qq.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(a,qq.status.UPLOAD_FAILED)),this._removeFromFilesInProgress(a),this._maybeParseAndSendUploadError(a,b,c,d)},_onCancel:function(a){this._netUploadedOrQueued--,this._removeFromFilesInProgress(a),clearTimeout(this._retryTimeouts[a]);var b=qq.indexOf(this._storedIds,a);!this._options.autoUpload&&b>=0&&this._storedIds.splice(b,1),this._uploadData.setStatus(a,qq.status.CANCELED)},_isDeletePossible:function(){return this._options.deleteFile.enabled?this._options.cors.expected?qq.supportedFeatures.deleteFileCorsXhr?!0:qq.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_onSubmitDelete:function(a,b){return this._isDeletePossible()?this._handleCheckedCallback({name:"onSubmitDelete",callback:qq.bind(this._options.callbacks.onSubmitDelete,this,a),onSuccess:b||qq.bind(this._deleteHandler.sendDelete,this,a,this.getUuid(a)),identifier:a}):(this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible "+"due to CORS on a user agent that does not support pre-flighting.","warn"),!1)},_onDelete:function(a){this._uploadData.setStatus(a,qq.status.DELETING)},_onDeleteComplete:function(a,b,c){var d=this._handler.getName(a);c?(this._uploadData.setStatus(a,qq.status.DELETE_FAILED),this.log("Delete request for '"+d+"' has failed.","error"),void 0===b.withCredentials?this._options.callbacks.onError(a,d,"Delete request failed",b):this._options.callbacks.onError(a,d,"Delete request failed with response code "+b.status,b)):(this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(a),this._uploadData.setStatus(a,qq.status.DELETED),this.log("Delete request for '"+d+"' has succeeded."))},_removeFromFilesInProgress:function(a){var b=qq.indexOf(this._filesInProgress,a);b>=0&&this._filesInProgress.splice(b,1)},_onUpload:function(a){this._uploadData.setStatus(a,qq.status.UPLOADING)},_onInputChange:function(a){qq.supportedFeatures.ajaxUploading?this.addFiles(a.files):this.addFiles(a),this._button.reset()},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+this._options.retry.autoAttemptDelay+" seconds before retrying "+b+"...")},_onAutoRetry:function(a,b){this.log("Retrying "+b+"..."),this._autoRetries[a]++,this._uploadData.setStatus(a,qq.status.UPLOAD_RETRYING),this._handler.retry(a)},_shouldAutoRetry:function(a){return!this._preventRetries[a]&&this._options.retry.enableAuto?(void 0===this._autoRetries[a]&&(this._autoRetries[a]=0),this._autoRetries[a]<this._options.retry.maxAutoAttempts):!1},_onBeforeManualRetry:function(a){var b=this._options.validation.itemLimit;if(this._preventRetries[a])return this.log("Retries are forbidden for id "+a,"warn"),!1;if(this._handler.isValid(a)){var c=this._handler.getName(a);return this._options.callbacks.onManualRetry(a,c)===!1?!1:b>0&&this._netUploadedOrQueued+1>b?(this._itemError("retryFailTooManyItems"),!1):(this.log("Retrying upload for '"+c+"' (id: "+a+")..."),this._filesInProgress.push(a),!0)}return this.log("'"+a+"' is not a valid file ID","error"),!1},_maybeParseAndSendUploadError:function(a,b,c,d){if(!c.success)if(d&&200!==d.status&&!c.error)this._options.callbacks.onError(a,b,"XHR returned response code "+d.status,d);else{var e=c.error?c.error:this._options.text.defaultResponseError;this._options.callbacks.onError(a,b,e,d)}},_prepareItemsForUpload:function(a,b,c){var d=this._getValidationDescriptors(a);this._handleCheckedCallback({name:"onValidateBatch",callback:qq.bind(this._options.callbacks.onValidateBatch,this,d),onSuccess:qq.bind(this._onValidateBatchCallbackSuccess,this,d,a,b,c),identifier:"batch validation"})},_upload:function(a,b,c){var d=this._handler.add(a),e=this._handler.getName(d);this._uploadData.added(d),b&&this.setParams(b,d),c&&this.setEndpoint(c,d),this._handleCheckedCallback({name:"onSubmit",callback:qq.bind(this._options.callbacks.onSubmit,this,d,e),onSuccess:qq.bind(this._onSubmitCallbackSuccess,this,d,e),onFailure:qq.bind(this._fileOrBlobRejected,this,d,e),identifier:d})},_onSubmitCallbackSuccess:function(a){this._uploadData.setStatus(a,qq.status.SUBMITTED),this._onSubmit.apply(this,arguments),this._onSubmitted.apply(this,arguments),this._options.callbacks.onSubmitted.apply(this,arguments),this._options.autoUpload?this._handler.upload(a)||this._uploadData.setStatus(a,qq.status.QUEUED):this._storeForLater(a)},_onSubmitted:function(){},_storeForLater:function(a){this._storedIds.push(a)},_onValidateBatchCallbackSuccess:function(a,b,c,d){var e,f=this._options.validation.itemLimit,g=this._netUploadedOrQueued+a.length;0===f||f>=g?b.length>0?this._handleCheckedCallback({name:"onValidate",callback:qq.bind(this._options.callbacks.onValidate,this,b[0]),onSuccess:qq.bind(this._onValidateCallbackSuccess,this,b,0,c,d),onFailure:qq.bind(this._onValidateCallbackFailure,this,b,0,c,d),identifier:"Item '"+b[0].name+"', size: "+b[0].size}):this._itemError("noFilesError"):(e=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,g).replace(/\{itemLimit\}/g,f),this._batchError(e))},_onValidateCallbackSuccess:function(a,b,c,d){var e=b+1,f=this._getValidationDescriptor(a[b]),g=!1;this._validateFileOrBlobData(a[b],f)&&(g=!0,this._upload(a[b],c,d)),this._maybeProcessNextItemAfterOnValidateCallback(g,a,e,c,d)},_onValidateCallbackFailure:function(a,b,c,d){var e=b+1;this._fileOrBlobRejected(void 0,a[0].name),this._maybeProcessNextItemAfterOnValidateCallback(!1,a,e,c,d)},_maybeProcessNextItemAfterOnValidateCallback:function(a,b,c,d,e){var f=this;b.length>c&&(a||!this._options.validation.stopOnFirstInvalidFile)&&setTimeout(function(){var a=f._getValidationDescriptor(b[c]);f._handleCheckedCallback({name:"onValidate",callback:qq.bind(f._options.callbacks.onValidate,f,b[c]),onSuccess:qq.bind(f._onValidateCallbackSuccess,f,b,c,d,e),onFailure:qq.bind(f._onValidateCallbackFailure,f,b,c,d,e),identifier:"Item '"+a.name+"', size: "+a.size})},0)},_validateFileOrBlobData:function(a,b){var c=b.name,d=b.size,e=!0;return this._options.callbacks.onValidate(b)===!1&&(e=!1),qq.isFileOrInput(a)&&!this._isAllowedExtension(c)?(this._itemError("typeError",c),e=!1):0===d?(this._itemError("emptyError",c),e=!1):d&&this._options.validation.sizeLimit&&d>this._options.validation.sizeLimit?(this._itemError("sizeError",c),e=!1):d&&d<this._options.validation.minSizeLimit&&(this._itemError("minSizeError",c),e=!1),e||this._fileOrBlobRejected(void 0,c),e},_fileOrBlobRejected:function(a){void 0!==a&&this._uploadData.setStatus(a,qq.status.REJECTED)},_itemError:function(a,b){function c(a,b){f=f.replace(a,b)}var d,e,f=this._options.messages[a],g=[],h=[].concat(b),i=h[0];return qq.each(this._options.validation.allowedExtensions,function(a,b){qq.isString(b)&&g.push(b)}),d=g.join(", ").toLowerCase(),c("{file}",this._options.formatFileName(i)),c("{extensions}",d),c("{sizeLimit}",this._formatSize(this._options.validation.sizeLimit)),c("{minSizeLimit}",this._formatSize(this._options.validation.minSizeLimit)),e=f.match(/(\{\w+\})/g),null!==e&&qq.each(e,function(a,b){c(b,h[a])}),this._options.callbacks.onError(null,i,f,void 0),f},_batchError:function(a){this._options.callbacks.onError(null,null,a,void 0)},_isAllowedExtension:function(a){var b=this._options.validation.allowedExtensions,c=!1;return b.length?(qq.each(b,function(b,d){if(qq.isString(d)){var e=new RegExp("\\."+d+"$","i");if(null!=a.match(e))return c=!0,!1}}),c):!0},_formatSize:function(a){var b=-1;do a/=1e3,b++;while(a>999);return Math.max(a,.1).toFixed(1)+this._options.text.sizeSymbols[b]},_wrapCallbacks:function(){var a,b;a=this,b=function(b,c,d){try{return c.apply(a,d)}catch(e){a.log("Caught exception in '"+b+"' callback - "+e.message,"error")}};for(var c in this._options.callbacks)!function(){var d,e;d=c,e=a._options.callbacks[d],a._options.callbacks[d]=function(){return b(d,e,arguments)}}()},_parseFileOrBlobDataName:function(a){var b;return b=qq.isFileOrInput(a)?a.value?a.value.replace(/.*(\/|\\)/,""):null!==a.fileName&&void 0!==a.fileName?a.fileName:a.name:a.name},_parseFileOrBlobDataSize:function(a){var b;return qq.isFileOrInput(a)?a.value||(b=null!==a.fileSize&&void 0!==a.fileSize?a.fileSize:a.size):b=a.blob.size,b},_getValidationDescriptor:function(a){var b,c,d;return d={},b=this._parseFileOrBlobDataName(a),c=this._parseFileOrBlobDataSize(a),d.name=b,void 0!==c&&(d.size=c),d},_getValidationDescriptors:function(a){var b=this,c=[];return qq.each(a,function(a,d){c.push(b._getValidationDescriptor(d))
}),c},_createParamsStore:function(a){var b={},c=this;return{setParams:function(a,c){var d={};qq.extend(d,a),b[c]=d},getParams:function(d){var e={};return null!=d&&b[d]?qq.extend(e,b[d]):qq.extend(e,c._options[a].params),e},remove:function(a){return delete b[a]},reset:function(){b={}}}},_createEndpointStore:function(a){var b={},c=this;return{setEndpoint:function(a,c){b[c]=a},getEndpoint:function(d){return null!=d&&b[d]?b[d]:c._options[a].endpoint},remove:function(a){return delete b[a]},reset:function(){b={}}}},_handleCameraAccess:function(){this._options.camera.ios&&qq.ios()&&(this._options.multiple=!1,null===this._options.validation.acceptFiles?this._options.validation.acceptFiles="image/*;capture=camera":this._options.validation.acceptFiles+=",image/*;capture=camera")}},qq.DragAndDrop=function(a){"use strict";function b(a){h.callbacks.dropLog("Grabbed "+a.length+" dropped files."),i.dropDisabled(!1),h.callbacks.processingDroppedFilesComplete(a)}function c(a){var b,d,e=new qq.Promise;return a.isFile?a.file(function(a){j.push(a),e.success()},function(b){h.callbacks.dropLog("Problem parsing '"+a.fullPath+"'.  FileError code "+b.code+".","error"),e.failure()}):a.isDirectory&&(b=a.createReader(),b.readEntries(function(a){var b=a.length;for(d=0;d<a.length;d+=1)c(a[d]).done(function(){b-=1,0===b&&e.success()});a.length||e.success()},function(b){h.callbacks.dropLog("Problem parsing '"+a.fullPath+"'.  FileError code "+b.code+".","error"),e.failure()})),e}function d(a){var b,d,e,f=[],g=new qq.Promise;if(h.callbacks.processingDroppedFiles(),i.dropDisabled(!0),a.files.length>1&&!h.allowMultipleItems)h.callbacks.processingDroppedFilesComplete([]),h.callbacks.dropError("tooManyFilesError",""),i.dropDisabled(!1),g.failure();else{if(j=[],qq.isFolderDropSupported(a))for(d=a.items,b=0;b<d.length;b+=1)e=d[b].webkitGetAsEntry(),e&&(e.isFile?j.push(d[b].getAsFile()):f.push(c(e).done(function(){f.pop(),0===f.length&&g.success()})));else j=a.files;0===f.length&&g.success()}return g}function e(a){i=new qq.UploadDropZone({element:a,onEnter:function(b){qq(a).addClass(h.classes.dropActive),b.stopPropagation()},onLeaveNotDescendants:function(){qq(a).removeClass(h.classes.dropActive)},onDrop:function(c){h.hideDropZonesBeforeEnter&&qq(a).hide(),qq(a).removeClass(h.classes.dropActive),d(c.dataTransfer).done(function(){b(j)})}}),k.addDisposer(function(){i.dispose()}),h.hideDropZonesBeforeEnter&&qq(a).hide()}function f(a){var b;return qq.each(a.dataTransfer.types,function(a,c){return"Files"===c?(b=!0,!1):void 0}),b}function g(){var a=h.dropZoneElements;qq.each(a,function(a,b){e(b)}),!a.length||qq.ie()&&!qq.ie10()||k.attach(document,"dragenter",function(b){!i.dropDisabled()&&f(b)&&qq.each(a,function(a,b){qq(b).css({display:"block"})})}),k.attach(document,"dragleave",function(b){h.hideDropZonesBeforeEnter&&qq.FineUploader.prototype._leaving_document_out(b)&&qq.each(a,function(a,b){qq(b).hide()})}),k.attach(document,"drop",function(b){h.hideDropZonesBeforeEnter&&qq.each(a,function(a,b){qq(b).hide()}),b.preventDefault()})}var h,i,j=[],k=new qq.DisposeSupport;return h={dropZoneElements:[],hideDropZonesBeforeEnter:!1,allowMultipleItems:!0,classes:{dropActive:null},callbacks:new qq.DragAndDrop.callbacks},qq.extend(h,a,!0),g(),{setupExtraDropzone:function(a){h.dropZoneElements.push(a),e(a)},removeDropzone:function(a){var b,c=h.dropZoneElements;for(b in c)if(c[b]===a)return c.splice(b,1)},dispose:function(){k.dispose(),i.dispose()}}},qq.DragAndDrop.callbacks=function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(){},dropError:function(a,b){qq.log("Drag & drop error code '"+a+" with these specifics: '"+b+"'","error")},dropLog:function(a,b){qq.log(a,b)}}},qq.UploadDropZone=function(a){"use strict";function b(){return qq.safari()||qq.firefox()&&qq.windows()}function c(){j||(b?k.attach(document,"dragover",function(a){a.preventDefault()}):k.attach(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),j=!0)}function d(a){if(qq.ie()&&!qq.ie10())return!1;var b,c=a.dataTransfer,d=qq.safari();return b=qq.ie10()?!0:"none"!==c.effectAllowed,c&&b&&(c.files||!d&&c.types.contains&&c.types.contains("Files"))}function e(a){return void 0!==a&&(i=a),i}function f(){k.attach(h,"dragover",function(a){if(d(a)){var b=qq.ie()?null:a.dataTransfer.effectAllowed;a.dataTransfer.dropEffect="move"===b||"linkMove"===b?"move":"copy",a.stopPropagation(),a.preventDefault()}}),k.attach(h,"dragenter",function(a){if(!e()){if(!d(a))return;g.onEnter(a)}}),k.attach(h,"dragleave",function(a){if(d(a)){g.onLeave(a);var b=document.elementFromPoint(a.clientX,a.clientY);qq(this).contains(b)||g.onLeaveNotDescendants(a)}}),k.attach(h,"drop",function(a){if(!e()){if(!d(a))return;a.preventDefault(),g.onDrop(a)}})}var g,h,i,j,k=new qq.DisposeSupport;return g={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}},qq.extend(g,a),h=g.element,c(),f(),{dropDisabled:function(a){return e(a)},dispose:function(){k.dispose()}}},qq.FineUploader=function(a){qq.FineUploaderBasic.apply(this,arguments),qq.extend(this._options,{element:null,listElement:null,dragAndDrop:{extraDropzones:[],hideDropzones:!0,disableDefaultDropzone:!1},text:{uploadButton: '选择上传文件',cancelButton:'取消',retryButton:'重试',deleteButton:'删除',failUpload:'上传失败',dragZone:'拖放文件到这里，上传',dropProcessing:'放弃上传的文件...',formatProgress: "{percent}% of {total_size}",waitingForResponse:"处理..."},template:'<div class="qq-uploader">'+(this._options.dragAndDrop&&this._options.dragAndDrop.disableDefaultDropzone?"":'<div class="qq-upload-drop-area"><span>{dragZoneText}</span></div>')+(this._options.button?"":'<div class="qq-upload-button"><div>{uploadButtonText}</div></div>')+'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>'+(this._options.listElement?"":'<ul class="qq-upload-list"></ul>')+"</div>",fileTemplate:'<li><div class="qq-progress-bar"></div><span class="qq-upload-spinner"></span><span class="qq-upload-finished"></span>'+(this._options.editFilename&&this._options.editFilename.enabled?'<span class="qq-edit-filename-icon"></span>':"")+'<span class="qq-upload-file"></span>'+(this._options.editFilename&&this._options.editFilename.enabled?'<input class="qq-edit-filename" tabindex="0" type="text">':"")+'<span class="qq-upload-size"></span>'+'<a class="qq-upload-cancel" href="#">{cancelButtonText}</a>'+'<a class="qq-upload-retry" href="#">{retryButtonText}</a>'+'<a class="qq-upload-delete" href="#">{deleteButtonText}</a>'+'<span class="qq-upload-status-text">{statusText}</span>'+"</li>",classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",progressBar:"qq-progress-bar",file:"qq-upload-file",spinner:"qq-upload-spinner",finished:"qq-upload-finished",retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",size:"qq-upload-size",cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry",statusText:"qq-upload-status-text",editFilenameInput:"qq-edit-filename",success:"qq-upload-success",fail:"qq-upload-fail",successIcon:null,failIcon:null,editNameIcon:"qq-edit-filename-icon",editable:"qq-editable",dropProcessing:"qq-drop-processing",dropProcessingSpinner:"qq-drop-processing-spinner"},failedUploadTextDisplay:{mode:"default",maxChars:50,responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}...",showButton:!1},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},editFilename:{enabled:!1},showMessage:function(a){setTimeout(function(){window.alert(a)},0)},showConfirm:function(a,b,c){setTimeout(function(){var d=window.confirm(a);d?b():c&&c()},0)},showPrompt:function(a,b){var c=new qq.Promise,d=window.prompt(a,b);return null!=d&&qq.trimStr(d).length>0?c.success(d):c.failure("Undefined or invalid user-supplied value."),c}},!0),qq.extend(this._options,a,!0),!qq.supportedFeatures.uploading||this._options.cors.expected&&!qq.supportedFeatures.uploadCors?this._options.element.innerHTML="<div>"+this._options.messages.unsupportedBrowser+"</div>":(this._wrapCallbacks(),this._options.template=this._options.template.replace(/\{dragZoneText\}/g,this._options.text.dragZone),this._options.template=this._options.template.replace(/\{uploadButtonText\}/g,this._options.text.uploadButton),this._options.template=this._options.template.replace(/\{dropProcessingText\}/g,this._options.text.dropProcessing),this._options.fileTemplate=this._options.fileTemplate.replace(/\{cancelButtonText\}/g,this._options.text.cancelButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{retryButtonText\}/g,this._options.text.retryButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{deleteButtonText\}/g,this._options.text.deleteButton),this._options.fileTemplate=this._options.fileTemplate.replace(/\{statusText\}/g,""),this._element=this._options.element,this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._classes=this._options.classes,this._button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._deleteRetryOrCancelClickHandler=this._bindDeleteRetryOrCancelClickEvent(),this._focusinEventSupported=!qq.firefox(),this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent()),this._dnd=this._setupDragAndDrop(),this._options.paste.targetElement&&this._options.paste.promptForName&&this._setupPastePrompt(),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0)},qq.extend(qq.FineUploader.prototype,qq.FineUploaderBasic.prototype),qq.extend(qq.FineUploader.prototype,{clearStoredFiles:function(){qq.FineUploaderBasic.prototype.clearStoredFiles.apply(this,arguments),this._listElement.innerHTML=""},addExtraDropzone:function(a){this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){return this._dnd.removeDropzone(a)},getItemByFileId:function(a){for(var b=this._listElement.firstChild;b;){if(b.qqFileId==a)return b;b=b.nextSibling}},reset:function(){qq.FineUploaderBasic.prototype.reset.apply(this,arguments),this._element.innerHTML=this._options.template,this._listElement=this._options.listElement||this._find(this._element,"list"),this._options.button||(this._button=this._createUploadButton(this._find(this._element,"button"))),this._dnd.dispose(),this._dnd=this._setupDragAndDrop(),this._totalFilesInBatch=0,this._filesInBatchAddedToUi=0},_removeFileItem:function(a){var b=this.getItemByFileId(a);qq(b).remove()},_setupDragAndDrop:function(){var a,b=this,c=this._find(this._element,"dropProcessing"),d=this._options.dragAndDrop.extraDropzones;return a=function(a){a.preventDefault()},this._options.dragAndDrop.disableDefaultDropzone||d.push(this._find(this._options.element,"drop")),new qq.DragAndDrop({dropZoneElements:d,hideDropZonesBeforeEnter:this._options.dragAndDrop.hideDropzones,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){var d=b._button.getInput();qq(c).css({display:"block"}),qq(d).attach("click",a)},processingDroppedFilesComplete:function(d){var e=b._button.getInput();qq(c).hide(),qq(e).detach("click",a),d&&b.addFiles(d)},dropError:function(a,c){b._itemError(a,c)},dropLog:function(a,c){b.log(a,c)}}})},_bindDeleteRetryOrCancelClickEvent:function(){var a=this;return new qq.DeleteRetryOrCancelClickHandler({listElement:this._listElement,classes:this._classes,log:function(b,c){a.log(b,c)},onDeleteFile:function(b){a.deleteFile(b)},onCancel:function(b){a.cancel(b)},onRetry:function(b){var c=a.getItemByFileId(b);qq(c).removeClass(a._classes.retryable),a.retry(b)},onGetName:function(b){return a.getName(b)}})},_isEditFilenameEnabled:function(){return this._options.editFilename.enabled&&!this._options.autoUpload},_filenameEditHandler:function(){var a=this;return{listElement:this._listElement,classes:this._classes,log:function(b,c){a.log(b,c)},onGetUploadStatus:function(b){return a.getUploads({id:b}).status},onGetName:function(b){return a.getName(b)},onSetName:function(b,c){var d=a.getItemByFileId(b),e=qq(a._find(d,"file")),f=a._options.formatFileName(c);e.setText(f),a.setName(b,c)},onGetInput:function(b){return a._find(b,"editFilenameInput")},onEditingStatusChange:function(b,c){var d=a.getItemByFileId(b),e=qq(a._find(d,"editFilenameInput")),f=qq(a._find(d,"file")),g=qq(a._find(d,"editNameIcon")),h=a._classes.editable;c?(e.addClass("qq-editing"),f.hide(),g.removeClass(h)):(e.removeClass("qq-editing"),f.css({display:""}),g.addClass(h)),qq(d).addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(a,b,c){if(this._isEditFilenameEnabled()){var d,e,f=this.getItemByFileId(a),g=this._classes.editable;f&&c!==qq.status.SUBMITTED&&(d=qq(this._find(f,"file")),e=qq(this._find(f,"editNameIcon")),d.removeClass(g),e.removeClass(g))}},_bindFilenameInputFocusInEvent:function(){var a=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusInHandler(a)},_bindFilenameInputFocusEvent:function(){var a=qq.extend({},this._filenameEditHandler());return new qq.FilenameInputFocusHandler(a)},_bindFilenameClickEvent:function(){var a=qq.extend({},this._filenameEditHandler());return new qq.FilenameClickHandler(a)},_leaving_document_out:function(a){return(qq.chrome()||qq.safari()&&qq.windows())&&0==a.clientX&&0==a.clientY||qq.firefox()&&!a.relatedTarget},_storeForLater:function(a){qq.FineUploaderBasic.prototype._storeForLater.apply(this,arguments);var b=this.getItemByFileId(a);qq(this._find(b,"spinner")).hide()},_find:function(a,b){var c=qq(a).getByClass(this._options.classes[b])[0];if(!c)throw new Error("element not found "+b);return c},_onSubmit:function(a,b){qq.FineUploaderBasic.prototype._onSubmit.apply(this,arguments),this._addToList(a,b)},_onSubmitted:function(a){if(this._isEditFilenameEnabled()){var b=this.getItemByFileId(a),c=qq(this._find(b,"file")),d=qq(this._find(b,"editNameIcon")),e=this._classes.editable;c.addClass(e),d.addClass(e),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._find(b,"editFilenameInput"))}},_onProgress:function(a,b,c,d){qq.FineUploaderBasic.prototype._onProgress.apply(this,arguments);var e,f,g,h;e=this.getItemByFileId(a),f=this._find(e,"progressBar"),g=Math.round(100*(c/d)),c===d?(h=this._find(e,"cancel"),qq(h).hide(),qq(f).hide(),qq(this._find(e,"statusText")).setText(this._options.text.waitingForResponse),this._displayFileSize(a)):(this._displayFileSize(a,c,d),qq(f).css({display:"block"})),qq(f).css({width:g+"%"})},_onComplete:function(a,b,c){qq.FineUploaderBasic.prototype._onComplete.apply(this,arguments);var d=this.getItemByFileId(a);qq(this._find(d,"statusText")).clearText(),qq(d).removeClass(this._classes.retrying),qq(this._find(d,"progressBar")).hide(),(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading)&&qq(this._find(d,"cancel")).hide(),qq(this._find(d,"spinner")).hide(),c.success?(this._isDeletePossible()&&this._showDeleteLink(a),qq(d).addClass(this._classes.success),this._classes.successIcon&&(this._find(d,"finished").style.display="inline-block",qq(d).addClass(this._classes.successIcon))):(qq(d).addClass(this._classes.fail),this._classes.failIcon&&(this._find(d,"finished").style.display="inline-block",qq(d).addClass(this._classes.failIcon)),this._options.retry.showButton&&!this._preventRetries[a]&&qq(d).addClass(this._classes.retryable),this._controlFailureTextDisplay(d,c))},_onUpload:function(a){qq.FineUploaderBasic.prototype._onUpload.apply(this,arguments),this._showSpinner(a)},_onCancel:function(a){qq.FineUploaderBasic.prototype._onCancel.apply(this,arguments),this._removeFileItem(a)},_onBeforeAutoRetry:function(a){var b,c,d,e,f,g;qq.FineUploaderBasic.prototype._onBeforeAutoRetry.apply(this,arguments),b=this.getItemByFileId(a),c=this._find(b,"progressBar"),this._showCancelLink(b),c.style.width=0,qq(c).hide(),this._options.retry.showAutoRetryNote&&(d=this._find(b,"statusText"),e=this._autoRetries[a]+1,f=this._options.retry.maxAutoAttempts,g=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,e),g=g.replace(/\{maxAuto\}/g,f),qq(d).setText(g),1===e&&qq(b).addClass(this._classes.retrying))},_onBeforeManualRetry:function(a){var b=this.getItemByFileId(a);return qq.FineUploaderBasic.prototype._onBeforeManualRetry.apply(this,arguments)?(this._find(b,"progressBar").style.width=0,qq(b).removeClass(this._classes.fail),qq(this._find(b,"statusText")).clearText(),this._showSpinner(a),this._showCancelLink(b),!0):(qq(b).addClass(this._classes.retryable),!1)},_onSubmitDelete:function(a){var b=qq.bind(this._onSubmitDeleteSuccess,this,a);qq.FineUploaderBasic.prototype._onSubmitDelete.call(this,a,b)},_onSubmitDeleteSuccess:function(a){this._options.deleteFile.forceConfirm?this._showDeleteConfirm(a):this._sendDeleteRequest(a)},_onDeleteComplete:function(a,b,c){qq.FineUploaderBasic.prototype._onDeleteComplete.apply(this,arguments);var d=this.getItemByFileId(a),e=this._find(d,"spinner"),f=this._find(d,"statusText");qq(e).hide(),c?(qq(f).setText(this._options.deleteFile.deletingFailedText),this._showDeleteLink(a)):this._removeFileItem(a)},_sendDeleteRequest:function(a){var b=this.getItemByFileId(a),c=this._find(b,"deleteButton"),d=this._find(b,"statusText");qq(c).hide(),this._showSpinner(a),qq(d).setText(this._options.deleteFile.deletingStatusText),this._deleteHandler.sendDelete(a,this.getUuid(a))},_showDeleteConfirm:function(a){var b=this._handler.getName(a),c=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,b),d=(this.getUuid(a),this);this._options.showConfirm(c,function(){d._sendDeleteRequest(a)})},_addToList:function(a,b){var c=qq.toElement(this._options.fileTemplate);if(this._options.disableCancelForFormUploads&&!qq.supportedFeatures.ajaxUploading){var d=this._find(c,"cancel");qq(d).remove()}c.qqFileId=a;var e=this._find(c,"file");qq(e).setText(this._options.formatFileName(b)),qq(this._find(c,"size")).hide(),this._options.multiple||(this._handler.cancelAll(),this._clearList()),this._options.display.prependFiles?this._prependItem(c):this._listElement.appendChild(c),this._filesInBatchAddedToUi+=1,this._options.display.fileSizeOnSubmit&&qq.supportedFeatures.ajaxUploading&&this._displayFileSize(a)},_prependItem:function(a){var b=this._listElement,c=b.firstChild;this._totalFilesInBatch>1&&this._filesInBatchAddedToUi>0&&(c=qq(b).children()[this._filesInBatchAddedToUi-1].nextSibling),b.insertBefore(a,c)},_clearList:function(){this._listElement.innerHTML="",this.clearStoredFiles()},_displayFileSize:function(a,b,c){var d=this.getItemByFileId(a),e=this.getSize(a),f=this._formatSize(e),g=this._find(d,"size");void 0!==b&&void 0!==c&&(f=this._formatProgress(b,c)),qq(g).css({display:"inline"}),qq(g).setText(f)},_formatProgress:function(a,b){function c(a,b){d=d.replace(a,b)}var d=this._options.text.formatProgress;return c("{percent}",Math.round(100*(a/b))),c("{total_size}",this._formatSize(b)),d},_controlFailureTextDisplay:function(a,b){var c,d,e,f,g;c=this._options.failedUploadTextDisplay.mode,d=this._options.failedUploadTextDisplay.maxChars,e=this._options.failedUploadTextDisplay.responseProperty,"custom"===c?(f=b[e],f?f.length>d&&(g=f.substring(0,d)+"..."):(f=this._options.text.failUpload,this.log("'"+e+"' is not a valid property on the server response.","warn")),qq(this._find(a,"statusText")).setText(g||f),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(a,f)):"default"===c?qq(this._find(a,"statusText")).setText(this._options.text.failUpload):"none"!==c&&this.log("failedUploadTextDisplay.mode value of '"+c+"' is not valid","warn")},_showTooltip:function(a,b){a.title=b},_showSpinner:function(a){var b=this.getItemByFileId(a),c=this._find(b,"spinner");c.style.display="inline-block"},_showCancelLink:function(a){if(!this._options.disableCancelForFormUploads||qq.supportedFeatures.ajaxUploading){var b=this._find(a,"cancel");qq(b).css({display:"inline"})}},_showDeleteLink:function(a){var b=this.getItemByFileId(a),c=this._find(b,"deleteButton");qq(c).css({display:"inline"})},_itemError:function(){var a=qq.FineUploaderBasic.prototype._itemError.apply(this,arguments);this._options.showMessage(a)},_batchError:function(a){qq.FineUploaderBasic.prototype._batchError.apply(this,arguments),this._options.showMessage(a)},_setupPastePrompt:function(){var a=this;this._options.callbacks.onPasteReceived=function(){var b=a._options.paste.namePromptMessage,c=a._options.paste.defaultName;return a._options.showPrompt(b,c)}},_fileOrBlobRejected:function(){this._totalFilesInBatch-=1,qq.FineUploaderBasic.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(a){this._totalFilesInBatch=a.length,this._filesInBatchAddedToUi=0,qq.FineUploaderBasic.prototype._prepareItemsForUpload.apply(this,arguments)}}),qq.AjaxRequestor=function(a){"use strict";function b(){return qq.indexOf(["GET","POST","HEAD"],v.method)>=0}function c(){var a=!1;return qq.each(a,function(b,c){return qq.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],c)<0?(a=!0,!1):void 0}),a}function d(a){return v.cors.expected&&void 0===a.withCredentials}function e(){var a;return window.XMLHttpRequest&&(a=new XMLHttpRequest,void 0===a.withCredentials&&(a=new XDomainRequest)),a}function f(a,b){var c=u[a].xhr;return c||b||(c=v.cors.expected?e():new XMLHttpRequest,u[a].xhr=c),c}function g(a){var b,c=qq.indexOf(t,a),d=v.maxConnections;delete u[a],t.splice(c,1),t.length>=d&&d>c&&(b=t[d-1],j(b))}function h(a,b){var c=f(a),e=v.method,h=b===!1;g(a),h?r(e+" request for "+a+" has failed","error"):d(c)||q(c.status)||(h=!0,r(e+" request for "+a+" has failed - response code "+c.status,"error")),v.onComplete(a,c,h)}function i(a){var b={},c=u[a].additionalParams,d=v.mandatedParams;return v.paramsStore.getParams&&(b=v.paramsStore.getParams(a)),c&&qq.each(c,function(a,c){b[a]=c}),d&&qq.each(d,function(a,c){b[a]=c}),b}function j(a){var b,c=f(a),e=v.method,g=i(a);v.onSend(a),b=k(a,g),d(c)?(c.onload=m(a),c.onerror=n(a)):c.onreadystatechange=l(a),c.open(e,b,!0),v.cors.expected&&v.cors.sendCredentials&&!d(c)&&(c.withCredentials=!0),o(a),r("Sending "+e+" request for "+a),!s&&g?c.send(qq.obj2url(g,"")):c.send()}function k(a,b){var c=v.endpointStore.getEndpoint(a),d=u[a].addToPath;return void 0!=d&&(c+="/"+d),s&&b?qq.obj2url(b,c):c}function l(a){return function(){4===f(a).readyState&&h(a)}}function m(a){return function(){h(a)}}function n(a){return function(){h(a,!0)}}function o(a){var e=f(a),g=v.customHeaders;d(e)&&(v.cors.expected&&b()&&!c(g)||(e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Cache-Control","no-cache"))),"POST"!==v.method&&"PUT"!==v.method||d(e)||e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),d(e)||qq.each(g,function(a,b){e.setRequestHeader(a,b)})}function p(a){var b=f(a,!0),c=v.method;return b?(d(b)?(b.onerror=null,b.onload=null):b.onreadystatechange=null,b.abort(),g(a),r("Cancelled "+c+" for "+a),v.onCancel(a),!0):!1}function q(a){return qq.indexOf(v.successfulResponseCodes[v.method],a)>=0}var r,s,t=[],u=[],v={method:"POST",maxConnections:3,customHeaders:{},endpointStore:{},paramsStore:{},mandatedParams:{},successfulResponseCodes:{DELETE:[200,202,204],POST:[200,204]},cors:{expected:!1,sendCredentials:!1},log:function(){},onSend:function(){},onComplete:function(){},onCancel:function(){}};return qq.extend(v,a),r=v.log,s="GET"===v.method||"DELETE"===v.method,{send:function(a,b,c){u[a]={addToPath:b,additionalParams:c};var d=t.push(a);d<=v.maxConnections&&j(a)},cancel:function(a){return p(a)}}},qq.DeleteFileAjaxRequestor=function(a){"use strict";function b(){return f.method.toUpperCase()}function c(){return"POST"===b()?{_method:"DELETE"}:{}}var d,e=["POST","DELETE"],f={method:"DELETE",uuidParamName:"qquuid",endpointStore:{},maxConnections:3,customHeaders:{},paramsStore:{},demoMode:!1,cors:{expected:!1,sendCredentials:!1},log:function(){},onDelete:function(){},onDeleteComplete:function(){}};if(qq.extend(f,a),qq.indexOf(e,b())<0)throw new Error("'"+b()+"' is not a supported method for delete file requests!");return d=new qq.AjaxRequestor({method:b(),endpointStore:f.endpointStore,paramsStore:f.paramsStore,mandatedParams:c(),maxConnections:f.maxConnections,customHeaders:f.customHeaders,demoMode:f.demoMode,log:f.log,onSend:f.onDelete,onComplete:f.onDeleteComplete,cors:f.cors}),{sendDelete:function(a,c){var e={};f.log("Submitting delete file request for "+a),"DELETE"===b()?d.send(a,c):(e[f.uuidParamName]=c,d.send(a,null,e))}}},qq.WindowReceiveMessage=function(a){var b={log:function(){}},c={};return qq.extend(b,a),{receiveMessage:function(a,b){var d=function(a){b(a.data)};window.postMessage?c[a]=qq(window).attach("message",d):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(a){if(window.postMessage){var b=c[a];b&&b()}}}},qq.UploadHandler=function(a){"use strict";function b(a){var b,c=qq.indexOf(h,a),e=d.maxConnections;c>=0&&(h.splice(c,1),h.length>=e&&e>c&&(b=h[e-1],f.upload(b)))}function c(a){e("Cancelling "+a),d.paramsStore.remove(a),b(a)}var d,e,f,g,h=[];return d={debug:!1,forceMultipart:!0,paramsInBody:!1,paramsStore:{},endpointStore:{},filenameParam:"qqfilename",cors:{expected:!1,sendCredentials:!1},maxConnections:3,uuidParamName:"qquuid",totalFileSizeParamName:"qqtotalfilesize",chunking:{enabled:!1,partSize:2e6,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalParts:"qqtotalparts",filename:"qqfilename"}},resume:{enabled:!1,id:null,cookiesExpireIn:7,paramNames:{resuming:"qqresume"}},log:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},onUpload:function(){},onUploadChunk:function(){},onAutoRetry:function(){},onResume:function(){},onUuidChanged:function(){}},qq.extend(d,a),e=d.log,f=qq.supportedFeatures.ajaxUploading?new qq.UploadHandlerXhr(d,b,d.onUuidChanged,e):new qq.UploadHandlerForm(d,b,d.onUuidChanged,e),g={add:function(a){return f.add(a)},upload:function(a){var b=h.push(a);return b<=d.maxConnections?(f.upload(a),!0):!1},retry:function(a){var b=qq.indexOf(h,a);return b>=0?f.upload(a,!0):this.upload(a)},cancel:function(a){var b=f.cancel(a);qq.isPromise(b)?b.then(function(){c(a)}):b!==!1&&c(a)},cancelAll:function(){var a=this,b=[];qq.extend(b,h),qq.each(b,function(b,c){a.cancel(c)}),h=[]},getName:function(a){return f.getName(a)},setName:function(a,b){f.setName(a,b)},getSize:function(a){return f.getSize?f.getSize(a):void 0},getFile:function(a){return f.getFile?f.getFile(a):void 0},reset:function(){e("Resetting upload handler"),g.cancelAll(),h=[],f.reset()},expunge:function(a){return f.expunge(a)},getUuid:function(a){return f.getUuid(a)},isValid:function(a){return f.isValid(a)},getResumableFilesData:function(){return f.getResumableFilesData?f.getResumableFilesData():[]}}},qq.UploadHandlerForm=function(a,b,c,d){"use strict";function e(a){void 0!==t[a]&&(t[a](),delete t[a])}function f(a,b){var c=a.id,d=m(c);y[r[d]]=b,t[d]=qq(a).attach("load",function(){q[d]&&(w("Received iframe load event for CORS upload request (iframe name "+c+")"),u[c]=setTimeout(function(){var a="No valid message received from loaded iframe for iframe name "+c;w(a,"error"),b({error:a})},1e3))}),x.receiveMessage(c,function(a){w("Received the following window message: '"+a+"'");var b,d=i(m(c),a),f=d.uuid;f&&y[f]?(w("Handling response for iframe name "+c),clearTimeout(u[c]),delete u[c],e(c),b=y[f],delete y[f],x.stopReceivingMessages(c),b(d)):f||w("'"+a+"' does not contain a UUID - ignoring.")})}function g(a,b){p.cors.expected?f(a,b):t[a.id]=qq(a).attach("load",function(){if(w("Received response for "+a.id),a.parentNode){try{if(a.contentDocument&&a.contentDocument.body&&"false"==a.contentDocument.body.innerHTML)return}catch(c){w("Error when attempting to access iframe during handling of upload response ("+c+")","error")}b()}})}function h(a,b){var c;try{var d=b.contentDocument||b.contentWindow.document,e=d.body.innerHTML;w("converting iframe's innerHTML to JSON"),w("innerHTML = "+e),e&&e.match(/^<pre/i)&&(e=d.body.firstChild.firstChild.nodeValue),c=i(a,e)}catch(f){w("Error when attempting to parse form upload response ("+f+")","error"),c={success:!1}}return c}function i(a,b){var d;try{d=qq.parseJson(b),void 0!==d.newUuid&&(w("Server requested UUID change from '"+r[a]+"' to '"+d.newUuid+"'"),r[a]=d.newUuid,c(a,d.newUuid))}catch(e){w("Error when attempting to parse iframe upload response ("+e+")","error"),d={}}return d}function j(a){var b=n(a),c=qq.toElement('<iframe src="javascript:false;" name="'+b+'" />');return c.setAttribute("id",b),c.style.display="none",document.body.appendChild(c),c}function k(a,b){var c=p.paramsStore.getParams(a),d=p.demoMode?"GET":"POST",e=qq.toElement('<form method="'+d+'" enctype="multipart/form-data"></form>'),f=p.endpointStore.getEndpoint(a),g=f;return c[p.uuidParamName]=r[a],void 0!==s[a]&&(c[p.filenameParam]=s[a]),p.paramsInBody?qq.obj2Inputs(c,e):g=qq.obj2url(c,f),e.setAttribute("action",g),e.setAttribute("target",b.name),e.style.display="none",document.body.appendChild(e),e}function l(a){delete q[a],delete r[a],delete t[a],p.cors.expected&&(clearTimeout(u[a]),delete u[a],x.stopReceivingMessages(a));var b=document.getElementById(n(a));b&&(b.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),qq(b).remove())}function m(a){return a.split("_")[0]}function n(a){return a+"_"+z}var o,p=a,q=[],r=[],s=[],t={},u={},v=b,w=d,x=new qq.WindowReceiveMessage({log:w}),y={},z=qq.getUniqueId();return o={add:function(a){a.setAttribute("name",p.inputName);var b=q.push(a)-1;return r[b]=qq.getUniqueId(),a.parentNode&&qq(a).remove(),b},getName:function(a){return void 0!==s[a]?s[a]:o.isValid(a)?q[a].value.replace(/.*(\/|\\)/,""):(w(a+" is not a valid item ID.","error"),void 0)},setName:function(a,b){s[a]=b},isValid:function(a){return void 0!==q[a]},reset:function(){q=[],r=[],s=[],t={},z=qq.getUniqueId()},expunge:function(a){return l(a)},getUuid:function(a){return r[a]},cancel:function(a){var b=p.onCancel(a,o.getName(a));return qq.isPromise(b)?b.then(function(){l(a)}):b!==!1?(l(a),!0):!1},upload:function(a){var b,c=q[a],d=o.getName(a),f=j(a);if(!c)throw new Error("file with passed id was not added, or already uploaded or cancelled");p.onUpload(a,o.getName(a)),b=k(a,f),b.appendChild(c),g(f,function(b){w("iframe loaded");var c=b?b:h(a,f);e(a),p.cors.expected||qq(f).remove(),(c.success||!p.onAutoRetry(a,d,c))&&(p.onComplete(a,d,c),v(a))}),w("Sending upload request for "+a),b.submit(),qq(b).remove()}}},qq.UploadHandlerXhr=function(a,b,c,d){"use strict";function e(a,b,c){var d=K.getSize(a),e=K.getName(a);b[L.chunking.paramNames.partIndex]=c.part,b[L.chunking.paramNames.partByteOffset]=c.start,b[L.chunking.paramNames.chunkSize]=c.size,b[L.chunking.paramNames.totalParts]=c.count,b[L.totalFileSizeParamName]=d,T&&(b[L.filenameParam]=e)}function f(a){a[L.resume.paramNames.resuming]=!0}function g(a,b,c){return a.slice?a.slice(b,c):a.mozSlice?a.mozSlice(b,c):a.webkitSlice?a.webkitSlice(b,c):void 0}function h(a,b){var c=L.chunking.partSize,d=K.getSize(a),e=O[a].file||O[a].blobData.blob,f=c*b,h=f+c>=d?d:f+c,j=i(a);return{part:b,start:f,end:h,count:j,blob:g(e,f,h),size:h-f}}function i(a){var b=K.getSize(a),c=L.chunking.partSize;return Math.ceil(b/c)}function j(a){var b=new XMLHttpRequest;
return O[a].xhr=b,b}function k(a,b,c,d){var e=new FormData,f=L.demoMode?"GET":"POST",g=L.endpointStore.getEndpoint(d),h=g,i=K.getName(d),j=K.getSize(d),k=O[d].blobData,l=O[d].newName;return a[L.uuidParamName]=O[d].uuid,T&&(a[L.totalFileSizeParamName]=j,k&&(a[L.filenameParam]=k.name)),void 0!==l&&(a[L.filenameParam]=l),L.paramsInBody||(T||(a[L.inputName]=l||i),h=qq.obj2url(a,g)),b.open(f,h,!0),L.cors.expected&&L.cors.sendCredentials&&(b.withCredentials=!0),T?(L.paramsInBody&&qq.obj2FormData(a,e),e.append(L.inputName,c),e):c}function l(a,b){var c=L.customHeaders,d=O[a].file||O[a].blobData.blob;b.setRequestHeader("X-Requested-With","XMLHttpRequest"),b.setRequestHeader("Cache-Control","no-cache"),T||(b.setRequestHeader("Content-Type","application/octet-stream"),b.setRequestHeader("X-Mime-Type",d.type)),qq.each(c,function(a,c){b.setRequestHeader(a,c)})}function m(a,b,c){var d=K.getName(a),e=K.getSize(a);O[a].attemptingResume=!1,L.onProgress(a,d,e,e),L.onComplete(a,d,b,c),O[a]&&delete O[a].xhr,M(a)}function n(a){var b,c,d=O[a].remainingChunkIdxs[0],g=h(a,d),i=j(a),m=K.getSize(a),n=K.getName(a);void 0===O[a].loaded&&(O[a].loaded=0),R&&O[a].file&&z(a,g),i.onreadystatechange=y(a,i),i.upload.onprogress=function(b){if(b.lengthComputable){var c=b.loaded+O[a].loaded,e=o(a,d,b.total);L.onProgress(a,n,c,e)}},L.onUploadChunk(a,n,x(g)),c=L.paramsStore.getParams(a),e(a,c,g),O[a].attemptingResume&&f(c),b=k(c,i,g.blob,a),l(a,i),N("Sending chunked upload request for item "+a+": bytes "+(g.start+1)+"-"+g.end+" of "+m),i.send(b)}function o(a,b,c){var d=h(a,b),e=d.size,f=c-e,g=K.getSize(a),i=d.count,j=O[a].initialRequestOverhead,k=f-j;return O[a].lastRequestOverhead=f,0===b?(O[a].lastChunkIdxProgress=0,O[a].initialRequestOverhead=f,O[a].estTotalRequestsSize=g+i*f):O[a].lastChunkIdxProgress!==b&&(O[a].lastChunkIdxProgress=b,O[a].estTotalRequestsSize+=k),O[a].estTotalRequestsSize}function p(a){return T?O[a].lastRequestOverhead:0}function q(a,b,c){var d=O[a].remainingChunkIdxs.shift(),e=h(a,d);O[a].attemptingResume=!1,O[a].loaded+=e.size+p(a),O[a].remainingChunkIdxs.length>0?n(a):(R&&A(a),m(a,b,c))}function r(a,b){return 200!==a.status||!b.success||b.reset}function s(a,b){var d;try{d=qq.parseJson(b.responseText),void 0!==d.newUuid&&(N("Server requested UUID change from '"+O[a].uuid+"' to '"+d.newUuid+"'"),O[a].uuid=d.newUuid,c(a,d.newUuid))}catch(e){N("Error when attempting to parse xhr response text ("+e+")","error"),d={}}return d}function t(a){N("Server has ordered chunking effort to be restarted on next attempt for item ID "+a,"error"),R&&(A(a),O[a].attemptingResume=!1),O[a].remainingChunkIdxs=[],delete O[a].loaded,delete O[a].estTotalRequestsSize,delete O[a].initialRequestOverhead}function u(a){O[a].attemptingResume=!1,N("Server has declared that it cannot handle resume for item ID "+a+" - starting from the first chunk","error"),t(a),K.upload(a,!0)}function v(a,b,c){var d=K.getName(a);L.onAutoRetry(a,d,b,c)||m(a,b,c)}function w(a,b){var c;O[a]&&(N("xhr - server response received for "+a),N("responseText = "+b.responseText),c=s(a,b),r(b,c)?(c.reset&&t(a),O[a].attemptingResume&&c.reset?u(a):v(a,c,b)):Q?q(a,c,b):m(a,c,b))}function x(a){return{partIndex:a.part,startByte:a.start+1,endByte:a.end,totalParts:a.count}}function y(a,b){return function(){4===b.readyState&&w(a,b)}}function z(a,b){var c=K.getUuid(a),d=O[a].loaded,e=O[a].initialRequestOverhead,f=O[a].estTotalRequestsSize,g=C(a),h=c+P+b.part+P+d+P+e+P+f,i=L.resume.cookiesExpireIn;qq.setCookie(g,h,i)}function A(a){if(O[a].file){var b=C(a);qq.deleteCookie(b)}}function B(a){var b,c,d,e,f,g,h=qq.getCookie(C(a)),i=K.getName(a);if(h){if(b=h.split(P),5===b.length)return c=b[0],d=parseInt(b[1],10),e=parseInt(b[2],10),f=parseInt(b[3],10),g=parseInt(b[4],10),{uuid:c,part:d,lastByteSent:e,initialRequestOverhead:f,estTotalRequestsSize:g};N("Ignoring previously stored resume/chunk cookie for "+i+" - old cookie format","warn")}}function C(a){var b,c=K.getName(a),d=K.getSize(a),e=L.chunking.partSize;return b="qqfilechunk"+P+encodeURIComponent(c)+P+d+P+e,void 0!==S&&(b+=P+S),b}function D(){return null===L.resume.id||void 0===L.resume.id||qq.isFunction(L.resume.id)||qq.isObject(L.resume.id)?void 0:L.resume.id}function E(a,b){var c;for(c=i(a)-1;c>=b;c-=1)O[a].remainingChunkIdxs.unshift(c);n(a)}function F(a,b,c,d){c=d.part,O[a].loaded=d.lastByteSent,O[a].estTotalRequestsSize=d.estTotalRequestsSize,O[a].initialRequestOverhead=d.initialRequestOverhead,O[a].attemptingResume=!0,N("Resuming "+b+" at partition index "+c),E(a,c)}function G(a,b,c){var d,e=K.getName(a),f=h(a,b.part);d=L.onResume(a,e,x(f)),qq.isPromise(d)?(N("Waiting for onResume promise to be fulfilled for "+a),d.then(function(){F(a,e,c,b)},function(){N("onResume promise fulfilled - failure indicated.  Will not resume."),E(a,c)})):d!==!1?F(a,e,c,b):(N("onResume callback returned false.  Will not resume."),E(a,c))}function H(a,b){var c,d=0;O[a].remainingChunkIdxs&&0!==O[a].remainingChunkIdxs.length?n(a):(O[a].remainingChunkIdxs=[],R&&!b&&O[a].file?(c=B(a),c?G(a,c,d):E(a,d)):E(a,d))}function I(a){var b,c,d,e=O[a].file||O[a].blobData.blob,f=K.getName(a);O[a].loaded=0,b=j(a),b.upload.onprogress=function(b){b.lengthComputable&&(O[a].loaded=b.loaded,L.onProgress(a,f,b.loaded,b.total))},b.onreadystatechange=y(a,b),c=L.paramsStore.getParams(a),d=k(c,b,e,a),l(a,b),N("Sending upload request for "+a),b.send(d)}function J(a){var b=O[a].xhr;b&&(b.onreadystatechange=null,b.abort()),R&&A(a),delete O[a]}var K,L=a,M=b,N=d,O=[],P="|",Q=L.chunking.enabled&&qq.supportedFeatures.chunking,R=L.resume.enabled&&Q&&qq.supportedFeatures.resume,S=D(),T=L.forceMultipart||L.paramsInBody;return K={add:function(a){var b,c,d=qq.getUniqueId();if(qq.isFile(a))b=O.push({file:a})-1;else{if(!qq.isBlob(a.blob))throw new Error("Passed obj in not a File or BlobData (in qq.UploadHandlerXhr)");b=O.push({blobData:a})-1}return R&&(c=B(b),c&&(d=c.uuid)),O[b].uuid=d,b},getName:function(a){if(K.isValid(a)){var b=O[a].file,c=O[a].blobData,d=O[a].newName;return void 0!==d?d:b?null!==b.fileName&&void 0!==b.fileName?b.fileName:b.name:c.name}N(a+" is not a valid item ID.","error")},setName:function(a,b){O[a].newName=b},getSize:function(a){var b=O[a].file||O[a].blobData.blob;return qq.isFileOrInput(b)?null!=b.fileSize?b.fileSize:b.size:b.size},getFile:function(a){return O[a]?O[a].file||O[a].blobData.blob:void 0},isValid:function(a){return void 0!==O[a]},reset:function(){O=[]},expunge:function(a){return J(a)},getUuid:function(a){return O[a].uuid},upload:function(a,b){var c=this.getName(a);this.isValid(a)&&(L.onUpload(a,c),Q?H(a,b):I(a))},cancel:function(a){var b=L.onCancel(a,this.getName(a));return qq.isPromise(b)?b.then(function(){J(a)}):b!==!1?(J(a),!0):!1},getResumableFilesData:function(){var a=[],b=[];return Q&&R?(a=void 0===S?qq.getCookieNames(new RegExp("^qqfilechunk\\"+P+".+\\"+P+"\\d+\\"+P+L.chunking.partSize+"=")):qq.getCookieNames(new RegExp("^qqfilechunk\\"+P+".+\\"+P+"\\d+\\"+P+L.chunking.partSize+"\\"+P+S+"=")),qq.each(a,function(a,c){var d=c.split(P),e=qq.getCookie(c).split(P);b.push({name:decodeURIComponent(d[1]),size:d[2],uuid:e[0],partIdx:e[1]})}),b):[]}}},qq.UiEventHandler=function(a,b){"use strict";function c(a){d.attach(a,e.eventType,function(a){a=a||window.event;var b=a.target||a.srcElement;e.onHandled(b,a)})}var d=new qq.DisposeSupport,e={eventType:"click",attachTo:null,onHandled:function(){}},f={addHandler:function(a){c(a)},dispose:function(){d.dispose()}};return qq.extend(b,{getItemFromEventTarget:function(a){for(var b=a.parentNode;void 0===b.qqFileId;)b=b.parentNode;return b},getFileIdFromItem:function(a){return a.qqFileId},getDisposeSupport:function(){return d}}),qq.extend(e,a),e.attachTo&&c(e.attachTo),f},qq.DeleteRetryOrCancelClickHandler=function(a){"use strict";function b(a,b){if(qq(a).hasClass(e.classes.cancel)||qq(a).hasClass(e.classes.retry)||qq(a).hasClass(e.classes.deleteButton)){var f=d.getItemFromEventTarget(a),g=d.getFileIdFromItem(f);qq.preventDefault(b),e.log(qq.format("Detected valid cancel, retry, or delete click event on file '{}', ID: {}.",e.onGetName(g),g)),c(a,g)}}function c(a,b){qq(a).hasClass(e.classes.deleteButton)?e.onDeleteFile(b):qq(a).hasClass(e.classes.cancel)?e.onCancel(b):e.onRetry(b)}var d={},e={listElement:document,log:function(){},classes:{cancel:"qq-upload-cancel",deleteButton:"qq-upload-delete",retry:"qq-upload-retry"},onDeleteFile:function(){},onCancel:function(){},onRetry:function(){},onGetName:function(){}};qq.extend(e,a),e.eventType="click",e.onHandled=b,e.attachTo=e.listElement,qq.extend(this,new qq.UiEventHandler(e,d))},qq.FilenameEditHandler=function(a,b){"use strict";function c(a){var b=i.onGetName(a),c=b.lastIndexOf(".");return c>0&&(b=b.substr(0,c)),b}function d(a){var b=i.onGetName(a),c=b.lastIndexOf(".");return c>0?b.substr(c,b.length-c):void 0}function e(a,b){var c,e=a.value;void 0!==e&&qq.trimStr(e).length>0&&(c=d(b),void 0!==c&&(e+=d(b)),i.onSetName(b,e)),i.onEditingStatusChange(b,!1)}function f(a,c){b.getDisposeSupport().attach(a,"blur",function(){e(a,c)})}function g(a,c){b.getDisposeSupport().attach(a,"keyup",function(b){var d=b.keyCode||b.which;13===d&&e(a,c)})}var h,i={listElement:null,log:function(){},classes:{file:"qq-upload-file"},onGetUploadStatus:function(){},onGetName:function(){},onSetName:function(){},onGetInput:function(){},onEditingStatusChange:function(){}};return qq.extend(i,a),i.attachTo=i.listElement,h=qq.extend(this,new qq.UiEventHandler(i,b)),qq.extend(b,{handleFilenameEdit:function(a,b,d,e){var h=i.onGetInput(d);i.onEditingStatusChange(a,!0),h.value=c(a),e&&h.focus(),f(h,a),g(h,a)}}),h},qq.FilenameClickHandler=function(a){"use strict";function b(a,b){if(qq(a).hasClass(d.classes.file)||qq(a).hasClass(d.classes.editNameIcon)){var e=c.getItemFromEventTarget(a),f=c.getFileIdFromItem(e),g=d.onGetUploadStatus(f);g===qq.status.SUBMITTED&&(d.log(qq.format("Detected valid filename click event on file '{}', ID: {}.",d.onGetName(f),f)),qq.preventDefault(b),c.handleFilenameEdit(f,a,e,!0))}}var c={},d={log:function(){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(){},onGetName:function(){}};return qq.extend(d,a),d.eventType="click",d.onHandled=b,qq.extend(this,new qq.FilenameEditHandler(d,c))},qq.FilenameInputFocusInHandler=function(a,b){"use strict";function c(a){if(qq(a).hasClass(d.classes.editFilenameInput)){var c=b.getItemFromEventTarget(a),e=b.getFileIdFromItem(c),f=d.onGetUploadStatus(e);f===qq.status.SUBMITTED&&(d.log(qq.format("Detected valid filename input focus event on file '{}', ID: {}.",d.onGetName(e),e)),b.handleFilenameEdit(e,a,c))}}var d={listElement:null,classes:{editFilenameInput:"qq-edit-filename"},onGetUploadStatus:function(){},log:function(){}};return b||(b={}),d.eventType="focusin",d.onHandled=c,qq.extend(d,a),qq.extend(this,new qq.FilenameEditHandler(d,b))},qq.FilenameInputFocusHandler=function(a){"use strict";return a.eventType="focus",a.attachTo=null,qq.extend(this,new qq.FilenameInputFocusInHandler(a,{}))},function(a){"use strict";var b,c,d,e,f,g,h,i,j,k;g=["uploaderType"],d=function(a){if(a){var d=i(a);h(d),"basic"===f("uploaderType")?b(new qq.FineUploaderBasic(d)):b(new qq.FineUploader(d))}return c},e=function(a,b){var d=c.data("fineuploader");return b?(void 0===d&&(d={}),d[a]=b,c.data("fineuploader",d),void 0):void 0===d?null:d[a]},b=function(a){return e("uploader",a)},f=function(a,b){return e(a,b)},h=function(b){var d=b.callbacks={},e=new qq.FineUploaderBasic;a.each(e._options.callbacks,function(a){var b,e;b=/^on(\w+)/.exec(a)[1],b=b.substring(0,1).toLowerCase()+b.substring(1),e=c,d[a]=function(){var a=Array.prototype.slice.call(arguments);return e.triggerHandler(b,a)}})},i=function(b,d){var e,h;return e=void 0===d?"basic"!==b.uploaderType?{element:c[0]}:{}:d,a.each(b,function(b,c){a.inArray(b,g)>=0?f(b,c):c instanceof a?e[b]=c[0]:a.isPlainObject(c)?(e[b]={},i(c,e[b])):a.isArray(c)?(h=[],a.each(c,function(b,c){c instanceof a?a.merge(h,c):h.push(c)}),e[b]=h):e[b]=c}),void 0===d?e:void 0},j=function(c){return"string"===a.type(c)&&!c.match(/^_/)&&void 0!==b()[c]},k=function(c){var d,e=[],f=Array.prototype.slice.call(arguments,1);return i(f,e),d=b()[c].apply(b(),e),"object"!=typeof d||1!==d.nodeType&&9!==d.nodeType||!d.cloneNode||(d=a(d)),d},a.fn.fineUploader=function(e){var f=this,g=arguments,h=[];return this.each(function(i,l){if(c=a(l),b()&&j(e)){if(h.push(k.apply(f,g)),1===f.length)return!1}else"object"!=typeof e&&e?a.error("Method "+e+" does not exist on jQuery.fineUploader"):d.apply(f,g)}),1===h.length?h[0]:h.length>1?h:this}}(jQuery),function(a){"use strict";function b(a){a||(a={}),a.dropZoneElements=[i];var b=f(a);return e(b),d(new qq.DragAndDrop(b)),i}function c(a,b){var c=i.data(j);return b?(void 0===c&&(c={}),c[a]=b,i.data(j,c),void 0):void 0===c?null:c[a]}function d(a){return c("dndInstance",a)}function e(b){var c=b.callbacks={};new qq.FineUploaderBasic,a.each(new qq.DragAndDrop.callbacks,function(a){var b,d=a;b=i,c[a]=function(){var a=Array.prototype.slice.call(arguments),c=b.triggerHandler(d,a);return c}})}function f(b,c){var d,e;return d=void 0===c?{}:c,a.each(b,function(b,c){c instanceof a?d[b]=c[0]:a.isPlainObject(c)?(d[b]={},f(c,d[b])):a.isArray(c)?(e=[],a.each(c,function(b,c){c instanceof a?a.merge(e,c):e.push(c)}),d[b]=e):d[b]=c}),void 0===c?d:void 0}function g(b){return"string"===a.type(b)&&"dispose"===b&&void 0!==d()[b]}function h(a){var b=[],c=Array.prototype.slice.call(arguments,1);return f(c,b),d()[a].apply(d(),b)}var i,j="fineUploaderDnd";a.fn.fineUploaderDnd=function(c){var e=this,f=arguments,j=[];return this.each(function(k,l){if(i=a(l),d()&&g(c)){if(j.push(h.apply(e,f)),1===e.length)return!1}else"object"!=typeof c&&c?a.error("Method "+c+" does not exist in Fine Uploader's DnD module."):b.apply(e,f)}),1===j.length?j[0]:j.length>1?j:this}}(jQuery);

/* jQuery Plugin: Tokenizing Autocomplete Text Entry
 * Version 1.6.1 */
 (function($){var DEFAULT_SETTINGS={method:"GET",queryParam:"q",searchDelay:300,minChars:1,propertyToSearch:"name",jsonContainer:null,contentType:"json",prePopulate:null,processPrePopulate:false,hintText:"Type in a search term",noResultsText:"No results",searchingText:"Searching...",deleteText:"&times;",animateDropdown:true,theme:null,zindex:9999,resultsLimit:null,enableHTML:false,resultsFormatter:function(item){var string=item[this.propertyToSearch];return"<li>"+(this.enableHTML?string:_escapeHTML(string))+"</li>"},tokenFormatter:function(item){var string=item[this.propertyToSearch];return"<li><p>"+(this.enableHTML?string:_escapeHTML(string))+"</p></li>"},tokenLimit:null,tokenDelimiter:",",preventDuplicates:false,tokenValue:"id",allowFreeTagging:false,allowTabOut:false,onResult:null,onCachedResult:null,onAdd:null,onFreeTaggingAdd:null,onDelete:null,onReady:null,idPrefix:"token-input-",disabled:false};var DEFAULT_CLASSES={tokenList:"token-input-list",token:"token-input-token",tokenReadOnly:"token-input-token-readonly",tokenDelete:"token-input-delete-token",selectedToken:"token-input-selected-token",highlightedToken:"token-input-highlighted-token",dropdown:"token-input-dropdown",dropdownItem:"token-input-dropdown-item",dropdownItem2:"token-input-dropdown-item2",selectedDropdownItem:"token-input-selected-dropdown-item",inputToken:"token-input-input-token",focused:"token-input-focused",disabled:"token-input-disabled"};var POSITION={BEFORE:0,AFTER:1,END:2};var KEY={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,NUMPAD_ENTER:108,COMMA:188};var HTML_ESCAPES={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#x27;','/':'&#x2F;'};var HTML_ESCAPE_CHARS=/[&<>"'\/]/g;function coerceToString(val){return String((val===null||val===undefined)?'':val)}function _escapeHTML(text){return coerceToString(text).replace(HTML_ESCAPE_CHARS,function(match){return HTML_ESCAPES[match]})}var methods={init:function(url_or_data_or_function,options){var settings=$.extend({},DEFAULT_SETTINGS,options||{});return this.each(function(){$(this).data("settings",settings);$(this).data("tokenInputObject",new $.TokenList(this,url_or_data_or_function,settings))})},clear:function(){this.data("tokenInputObject").clear();return this},add:function(item){this.data("tokenInputObject").add(item);return this},remove:function(item){this.data("tokenInputObject").remove(item);return this},get:function(){return this.data("tokenInputObject").getTokens()},toggleDisabled:function(disable){this.data("tokenInputObject").toggleDisabled(disable);return this},setOptions:function(options){$(this).data("settings",$.extend({},$(this).data("settings"),options||{}));return this}};$.fn.tokenInput=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else{return methods.init.apply(this,arguments)}};$.TokenList=function(input,url_or_data,settings){if($.type(url_or_data)==="string"||$.type(url_or_data)==="function"){$(input).data("settings").url=url_or_data;var url=computeURL();if($(input).data("settings").crossDomain===undefined&&typeof url==="string"){if(url.indexOf("://")===-1){$(input).data("settings").crossDomain=false}else{$(input).data("settings").crossDomain=(location.href.split(/\/+/g)[1]!==url.split(/\/+/g)[1])}}}else if(typeof(url_or_data)==="object"){$(input).data("settings").local_data=url_or_data}if($(input).data("settings").classes){$(input).data("settings").classes=$.extend({},DEFAULT_CLASSES,$(input).data("settings").classes)}else if($(input).data("settings").theme){$(input).data("settings").classes={};$.each(DEFAULT_CLASSES,function(key,value){$(input).data("settings").classes[key]=value+"-"+$(input).data("settings").theme})}else{$(input).data("settings").classes=DEFAULT_CLASSES}var saved_tokens=[];var token_count=0;var cache=new $.TokenList.Cache();var timeout;var input_val;var input_box=$("<input type=\"text\"  autocomplete=\"off\">").css({outline:"none"}).attr("id",$(input).data("settings").idPrefix+input.id).focus(function(){if($(input).data("settings").disabled){return false}else if($(input).data("settings").tokenLimit===null||$(input).data("settings").tokenLimit!==token_count){show_dropdown_hint()}token_list.addClass($(input).data("settings").classes.focused)}).blur(function(){hide_dropdown();if($(input).data("settings").allowFreeTagging){add_freetagging_tokens()}$(this).val("");token_list.removeClass($(input).data("settings").classes.focused)}).bind("keyup keydown blur update",resize_input).keyup(function(event){setTimeout(function(){do_search()},5)}).keydown(function(event){var previous_token;var next_token;switch(event.keyCode){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:if(!$(this).val()){previous_token=input_token.prev();next_token=input_token.next();if((previous_token.length&&previous_token.get(0)===selected_token)||(next_token.length&&next_token.get(0)===selected_token)){if(event.keyCode===KEY.LEFT||event.keyCode===KEY.UP){deselect_token($(selected_token),POSITION.BEFORE)}else{deselect_token($(selected_token),POSITION.AFTER)}}else if((event.keyCode===KEY.LEFT||event.keyCode===KEY.UP)&&previous_token.length){select_token($(previous_token.get(0)))}else if((event.keyCode===KEY.RIGHT||event.keyCode===KEY.DOWN)&&next_token.length){select_token($(next_token.get(0)))}}else{var dropdown_item=null;if(event.keyCode===KEY.DOWN||event.keyCode===KEY.RIGHT){dropdown_item=$(selected_dropdown_item).next()}else{dropdown_item=$(selected_dropdown_item).prev()}if(dropdown_item.length){select_dropdown_item(dropdown_item)}}return false;break;case KEY.BACKSPACE:previous_token=input_token.prev();if(!$(this).val().length){if(selected_token){delete_token($(selected_token));hidden_input.change()}else if(previous_token.length){select_token($(previous_token.get(0)))}return false}else if($(this).val().length===1){hide_dropdown()}else{setTimeout(function(){do_search()},5)}break;case KEY.TAB:case KEY.ENTER:case KEY.NUMPAD_ENTER:case KEY.COMMA:if(selected_dropdown_item){add_token($(selected_dropdown_item).data("tokeninput"));hidden_input.change()}else{if($(input).data("settings").allowFreeTagging){if($(input).data("settings").allowTabOut&&$(this).val()===""){return true}else{add_freetagging_tokens()}}else{$(this).val("");if($(input).data("settings").allowTabOut){return true}}event.stopPropagation();event.preventDefault()}return false;case KEY.ESCAPE:hide_dropdown();return true;default:if(String.fromCharCode(event.which)){setTimeout(function(){do_search()},5)}break}});var hidden_input=$(input).hide().val("").focus(function(){focus_with_timeout(input_box)}).blur(function(){input_box.blur()});var selected_token=null;var selected_token_index=0;var selected_dropdown_item=null;var token_list=$("<ul />").addClass($(input).data("settings").classes.tokenList).click(function(event){var li=$(event.target).closest("li");if(li&&li.get(0)&&$.data(li.get(0),"tokeninput")){toggle_select_token(li)}else{if(selected_token){deselect_token($(selected_token),POSITION.END)}focus_with_timeout(input_box)}}).mouseover(function(event){var li=$(event.target).closest("li");if(li&&selected_token!==this){li.addClass($(input).data("settings").classes.highlightedToken)}}).mouseout(function(event){var li=$(event.target).closest("li");if(li&&selected_token!==this){li.removeClass($(input).data("settings").classes.highlightedToken)}}).insertBefore(hidden_input);var input_token=$("<li />").addClass($(input).data("settings").classes.inputToken).appendTo(token_list).append(input_box);var dropdown=$("<div>").addClass($(input).data("settings").classes.dropdown).appendTo("body").hide();var input_resizer=$("<tester/>").insertAfter(input_box).css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:input_box.css("fontSize"),fontFamily:input_box.css("fontFamily"),fontWeight:input_box.css("fontWeight"),letterSpacing:input_box.css("letterSpacing"),whiteSpace:"nowrap"});hidden_input.val("");var li_data=$(input).data("settings").prePopulate||hidden_input.data("pre");if($(input).data("settings").processPrePopulate&&$.isFunction($(input).data("settings").onResult)){li_data=$(input).data("settings").onResult.call(hidden_input,li_data)}if(li_data&&li_data.length){$.each(li_data,function(index,value){insert_token(value);checkTokenLimit()})}if($(input).data("settings").disabled){toggleDisabled(true)}if($.isFunction($(input).data("settings").onReady)){$(input).data("settings").onReady.call()}this.clear=function(){token_list.children("li").each(function(){if($(this).children("input").length===0){delete_token($(this))}})};this.add=function(item){add_token(item)};this.remove=function(item){token_list.children("li").each(function(){if($(this).children("input").length===0){var currToken=$(this).data("tokeninput");var match=true;for(var prop in item){if(item[prop]!==currToken[prop]){match=false;break}}if(match){delete_token($(this))}}})};this.getTokens=function(){return saved_tokens};this.toggleDisabled=function(disable){toggleDisabled(disable)};function escapeHTML(text){return $(input).data("settings").enableHTML?text:_escapeHTML(text)}function toggleDisabled(disable){if(typeof disable==='boolean'){$(input).data("settings").disabled=disable}else{$(input).data("settings").disabled=!$(input).data("settings").disabled}input_box.attr('disabled',$(input).data("settings").disabled);token_list.toggleClass($(input).data("settings").classes.disabled,$(input).data("settings").disabled);if(selected_token){deselect_token($(selected_token),POSITION.END)}hidden_input.attr('disabled',$(input).data("settings").disabled)}function checkTokenLimit(){if($(input).data("settings").tokenLimit!==null&&token_count>=$(input).data("settings").tokenLimit){input_box.hide();hide_dropdown();return}}function resize_input(){if(input_val===(input_val=input_box.val())){return}input_resizer.html(_escapeHTML(input_val));input_box.width(input_resizer.width()+30)}function is_printable_character(keycode){return((keycode>=48&&keycode<=90)||(keycode>=96&&keycode<=111)||(keycode>=186&&keycode<=192)||(keycode>=219&&keycode<=222))}function add_freetagging_tokens(){var value=$.trim(input_box.val());var tokens=value.split($(input).data("settings").tokenDelimiter);$.each(tokens,function(i,token){if(!token){return}if($.isFunction($(input).data("settings").onFreeTaggingAdd)){token=$(input).data("settings").onFreeTaggingAdd.call(hidden_input,token)}var object={};object[$(input).data("settings").tokenValue]=object[$(input).data("settings").propertyToSearch]=token;add_token(object)})}function insert_token(item){var $this_token=$($(input).data("settings").tokenFormatter(item));var readonly=item.readonly===true?true:false;if(readonly)$this_token.addClass($(input).data("settings").classes.tokenReadOnly);$this_token.addClass($(input).data("settings").classes.token).insertBefore(input_token);if(!readonly){$("<span>"+$(input).data("settings").deleteText+"</span>").addClass($(input).data("settings").classes.tokenDelete).appendTo($this_token).click(function(){if(!$(input).data("settings").disabled){delete_token($(this).parent());hidden_input.change();return false}})}var token_data=item;$.data($this_token.get(0),"tokeninput",item);saved_tokens=saved_tokens.slice(0,selected_token_index).concat([token_data]).concat(saved_tokens.slice(selected_token_index));selected_token_index++;update_hidden_input(saved_tokens,hidden_input);token_count+=1;if($(input).data("settings").tokenLimit!==null&&token_count>=$(input).data("settings").tokenLimit){input_box.hide();hide_dropdown()}return $this_token}function add_token(item){var callback=$(input).data("settings").onAdd;if(token_count>0&&$(input).data("settings").preventDuplicates){var found_existing_token=null;token_list.children().each(function(){var existing_token=$(this);var existing_data=$.data(existing_token.get(0),"tokeninput");if(existing_data&&existing_data[settings.tokenValue]===item[settings.tokenValue]){found_existing_token=existing_token;return false}});if(found_existing_token){select_token(found_existing_token);input_token.insertAfter(found_existing_token);focus_with_timeout(input_box);return}}if($(input).data("settings").tokenLimit==null||token_count<$(input).data("settings").tokenLimit){insert_token(item);checkTokenLimit()}input_box.val("");hide_dropdown();if($.isFunction(callback)){callback.call(hidden_input,item)}}function select_token(token){if(!$(input).data("settings").disabled){token.addClass($(input).data("settings").classes.selectedToken);selected_token=token.get(0);input_box.val("");hide_dropdown()}}function deselect_token(token,position){token.removeClass($(input).data("settings").classes.selectedToken);selected_token=null;if(position===POSITION.BEFORE){input_token.insertBefore(token);selected_token_index--}else if(position===POSITION.AFTER){input_token.insertAfter(token);selected_token_index++}else{input_token.appendTo(token_list);selected_token_index=token_count}focus_with_timeout(input_box)}function toggle_select_token(token){var previous_selected_token=selected_token;if(selected_token){deselect_token($(selected_token),POSITION.END)}if(previous_selected_token===token.get(0)){deselect_token(token,POSITION.END)}else{select_token(token)}}function delete_token(token){var token_data=$.data(token.get(0),"tokeninput");var callback=$(input).data("settings").onDelete;var index=token.prevAll().length;if(index>selected_token_index)index--;token.remove();selected_token=null;focus_with_timeout(input_box);saved_tokens=saved_tokens.slice(0,index).concat(saved_tokens.slice(index+1));if(index<selected_token_index)selected_token_index--;update_hidden_input(saved_tokens,hidden_input);token_count-=1;if($(input).data("settings").tokenLimit!==null){input_box.show().val("");focus_with_timeout(input_box)}if($.isFunction(callback)){callback.call(hidden_input,token_data)}}function update_hidden_input(saved_tokens,hidden_input){var token_values=$.map(saved_tokens,function(el){if(typeof $(input).data("settings").tokenValue=='function')return $(input).data("settings").tokenValue.call(this,el);return el[$(input).data("settings").tokenValue]});hidden_input.val(token_values.join($(input).data("settings").tokenDelimiter))}function hide_dropdown(){dropdown.hide().empty();selected_dropdown_item=null}function show_dropdown(){dropdown.css({position:"absolute",top:$(token_list).offset().top+$(token_list).height(),left:$(token_list).offset().left,width:$(token_list).width(),'z-index':$(input).data("settings").zindex}).show()}function show_dropdown_searching(){if($(input).data("settings").searchingText){dropdown.html("<p>"+escapeHTML($(input).data("settings").searchingText)+"</p>");show_dropdown()}}function show_dropdown_hint(){if($(input).data("settings").hintText){dropdown.html("<p>"+escapeHTML($(input).data("settings").hintText)+"</p>");show_dropdown()}}var regexp_special_chars=new RegExp('[.\\\\+*?\\[\\^\\]$(){}=!<>|:\\-]','g');function regexp_escape(term){return term.replace(regexp_special_chars,'\\$&')}function highlight_term(value,term){return value.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+regexp_escape(term)+")(?![^<>]*>)(?![^&;]+;)","gi"),function(match,p1){return"<b>"+escapeHTML(p1)+"</b>"})}function find_value_and_highlight_term(template,value,term){return template.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+regexp_escape(value)+")(?![^<>]*>)(?![^&;]+;)","g"),highlight_term(value,term))}function populate_dropdown(query,results){if(results&&results.length){dropdown.empty();var dropdown_ul=$("<ul>").appendTo(dropdown).mouseover(function(event){select_dropdown_item($(event.target).closest("li"))}).mousedown(function(event){add_token($(event.target).closest("li").data("tokeninput"));hidden_input.change();return false}).hide();if($(input).data("settings").resultsLimit&&results.length>$(input).data("settings").resultsLimit){results=results.slice(0,$(input).data("settings").resultsLimit)}$.each(results,function(index,value){var this_li=$(input).data("settings").resultsFormatter(value);this_li=find_value_and_highlight_term(this_li,value[$(input).data("settings").propertyToSearch],query);this_li=$(this_li).appendTo(dropdown_ul);if(index%2){this_li.addClass($(input).data("settings").classes.dropdownItem)}else{this_li.addClass($(input).data("settings").classes.dropdownItem2)}if(index===0){select_dropdown_item(this_li)}$.data(this_li.get(0),"tokeninput",value)});show_dropdown();if($(input).data("settings").animateDropdown){dropdown_ul.slideDown("fast")}else{dropdown_ul.show()}}else{if($(input).data("settings").noResultsText){dropdown.html("<p>"+escapeHTML($(input).data("settings").noResultsText)+"</p>");show_dropdown()}}}function select_dropdown_item(item){if(item){if(selected_dropdown_item){deselect_dropdown_item($(selected_dropdown_item))}item.addClass($(input).data("settings").classes.selectedDropdownItem);selected_dropdown_item=item.get(0)}}function deselect_dropdown_item(item){item.removeClass($(input).data("settings").classes.selectedDropdownItem);selected_dropdown_item=null}function do_search(){var query=input_box.val();if(query&&query.length){if(selected_token){deselect_token($(selected_token),POSITION.AFTER)}if(query.length>=$(input).data("settings").minChars){show_dropdown_searching();clearTimeout(timeout);timeout=setTimeout(function(){run_search(query)},$(input).data("settings").searchDelay)}else{hide_dropdown()}}}function run_search(query){var cache_key=query+computeURL();var cached_results=cache.get(cache_key);if(cached_results){if($.isFunction($(input).data("settings").onCachedResult)){cached_results=$(input).data("settings").onCachedResult.call(hidden_input,cached_results)}populate_dropdown(query,cached_results)}else{if($(input).data("settings").url){var url=computeURL();var ajax_params={};ajax_params.data={};if(url.indexOf("?")>-1){var parts=url.split("?");ajax_params.url=parts[0];var param_array=parts[1].split("&");$.each(param_array,function(index,value){var kv=value.split("=");ajax_params.data[kv[0]]=kv[1]})}else{ajax_params.url=url}ajax_params.data[$(input).data("settings").queryParam]=query;ajax_params.type=$(input).data("settings").method;ajax_params.dataType=$(input).data("settings").contentType;if($(input).data("settings").crossDomain){ajax_params.dataType="jsonp"}ajax_params.success=function(results){cache.add(cache_key,$(input).data("settings").jsonContainer?results[$(input).data("settings").jsonContainer]:results);if($.isFunction($(input).data("settings").onResult)){results=$(input).data("settings").onResult.call(hidden_input,results)}if(input_box.val()===query){populate_dropdown(query,$(input).data("settings").jsonContainer?results[$(input).data("settings").jsonContainer]:results)}};$.ajax(ajax_params)}else if($(input).data("settings").local_data){var results=$.grep($(input).data("settings").local_data,function(row){return row[$(input).data("settings").propertyToSearch].toLowerCase().indexOf(query.toLowerCase())>-1});cache.add(cache_key,results);if($.isFunction($(input).data("settings").onResult)){results=$(input).data("settings").onResult.call(hidden_input,results)}populate_dropdown(query,results)}}}function computeURL(){var url=$(input).data("settings").url;if(typeof $(input).data("settings").url=='function'){url=$(input).data("settings").url.call($(input).data("settings"))}return url}function focus_with_timeout(obj){setTimeout(function(){obj.focus()},50)}};$.TokenList.Cache=function(options){var settings=$.extend({max_size:500},options);var data={};var size=0;var flush=function(){data={};size=0};this.add=function(query,results){if(size>settings.max_size){flush()}if(!data[query]){size+=1}data[query]=results};this.get=function(query){return data[query]}}}(jQuery));
